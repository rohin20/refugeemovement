{"ast":null,"code":"import _classCallCheck from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { I3SPendingTilesRegister } from './i3s-pending-tiles-register';\nvar STATUS = {\n  REQUESTED: 'REQUESTED',\n  COMPLETED: 'COMPLETED',\n  ERROR: 'ERROR'\n};\nexport var I3STileManager = /*#__PURE__*/function () {\n  function I3STileManager() {\n    _classCallCheck(this, I3STileManager);\n    _defineProperty(this, \"_statusMap\", void 0);\n    _defineProperty(this, \"pendingTilesRegister\", new I3SPendingTilesRegister());\n    this._statusMap = {};\n  }\n  _createClass(I3STileManager, [{\n    key: \"add\",\n    value: function add(request, key, callback, frameState) {\n      var _this = this;\n      if (!this._statusMap[key]) {\n        var frameNumber = frameState.frameNumber,\n          id = frameState.viewport.id;\n        this._statusMap[key] = {\n          request: request,\n          callback: callback,\n          key: key,\n          frameState: frameState,\n          status: STATUS.REQUESTED\n        };\n        this.pendingTilesRegister.register(id, frameNumber);\n        request().then(function (data) {\n          _this._statusMap[key].status = STATUS.COMPLETED;\n          var _this$_statusMap$key$ = _this._statusMap[key].frameState,\n            actualFrameNumber = _this$_statusMap$key$.frameNumber,\n            id = _this$_statusMap$key$.viewport.id;\n          _this.pendingTilesRegister.deregister(id, actualFrameNumber);\n          _this._statusMap[key].callback(data, frameState);\n        }).catch(function (error) {\n          _this._statusMap[key].status = STATUS.ERROR;\n          var _this$_statusMap$key$2 = _this._statusMap[key].frameState,\n            actualFrameNumber = _this$_statusMap$key$2.frameNumber,\n            id = _this$_statusMap$key$2.viewport.id;\n          _this.pendingTilesRegister.deregister(id, actualFrameNumber);\n          callback(error);\n        });\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update(key, frameState) {\n      if (this._statusMap[key]) {\n        var _this$_statusMap$key$3 = this._statusMap[key].frameState,\n          frameNumber = _this$_statusMap$key$3.frameNumber,\n          id = _this$_statusMap$key$3.viewport.id;\n        this.pendingTilesRegister.deregister(id, frameNumber);\n        var newFrameNumber = frameState.frameNumber,\n          newViewportId = frameState.viewport.id;\n        this.pendingTilesRegister.register(newViewportId, newFrameNumber);\n        this._statusMap[key].frameState = frameState;\n      }\n    }\n  }, {\n    key: \"find\",\n    value: function find(key) {\n      return this._statusMap[key];\n    }\n  }, {\n    key: \"hasPendingTiles\",\n    value: function hasPendingTiles(viewportId, frameNumber) {\n      return !this.pendingTilesRegister.isZero(viewportId, frameNumber);\n    }\n  }]);\n  return I3STileManager;\n}();","map":{"version":3,"names":["I3SPendingTilesRegister","STATUS","REQUESTED","COMPLETED","ERROR","I3STileManager","_classCallCheck","_defineProperty","_statusMap","_createClass","key","value","add","request","callback","frameState","_this","frameNumber","id","viewport","status","pendingTilesRegister","register","then","data","_this$_statusMap$key$","actualFrameNumber","deregister","catch","error","_this$_statusMap$key$2","update","_this$_statusMap$key$3","newFrameNumber","newViewportId","find","hasPendingTiles","viewportId","isZero"],"sources":["/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@deck.gl/geo-layers/node_modules/@loaders.gl/tiles/src/tileset/format-i3s/i3s-tile-manager.ts"],"sourcesContent":["import {FrameState} from '../helpers/frame-state';\nimport {I3SPendingTilesRegister} from './i3s-pending-tiles-register';\n\nconst STATUS = {\n  REQUESTED: 'REQUESTED',\n  COMPLETED: 'COMPLETED',\n  ERROR: 'ERROR'\n};\n\n// A helper class to manage tile metadata fetching\nexport class I3STileManager {\n  private _statusMap: object;\n  private pendingTilesRegister = new I3SPendingTilesRegister();\n\n  constructor() {\n    this._statusMap = {};\n  }\n\n  /**\n   * Add request to map\n   * @param request - node metadata request\n   * @param key - unique key\n   * @param callback - callback after request completed\n   * @param frameState - frameState data\n   */\n  add(request, key, callback, frameState: FrameState) {\n    if (!this._statusMap[key]) {\n      const {\n        frameNumber,\n        viewport: {id}\n      } = frameState;\n      this._statusMap[key] = {request, callback, key, frameState, status: STATUS.REQUESTED};\n      // Register pending request for the frameNumber\n      this.pendingTilesRegister.register(id, frameNumber);\n      request()\n        .then((data) => {\n          this._statusMap[key].status = STATUS.COMPLETED;\n          const {\n            frameNumber: actualFrameNumber,\n            viewport: {id}\n          } = this._statusMap[key].frameState;\n          // Deregister pending request for the frameNumber\n          this.pendingTilesRegister.deregister(id, actualFrameNumber);\n          this._statusMap[key].callback(data, frameState);\n        })\n        .catch((error) => {\n          this._statusMap[key].status = STATUS.ERROR;\n          const {\n            frameNumber: actualFrameNumber,\n            viewport: {id}\n          } = this._statusMap[key].frameState;\n          // Deregister pending request for the frameNumber\n          this.pendingTilesRegister.deregister(id, actualFrameNumber);\n          callback(error);\n        });\n    }\n  }\n\n  /**\n   * Update request if it is still actual for the new frameState\n   * @param key - unique key\n   * @param frameState - frameState data\n   */\n  update(key, frameState: FrameState) {\n    if (this._statusMap[key]) {\n      // Deregister pending request for the old frameNumber\n      const {\n        frameNumber,\n        viewport: {id}\n      } = this._statusMap[key].frameState;\n      this.pendingTilesRegister.deregister(id, frameNumber);\n\n      // Register pending request for the new frameNumber\n      const {\n        frameNumber: newFrameNumber,\n        viewport: {id: newViewportId}\n      } = frameState;\n      this.pendingTilesRegister.register(newViewportId, newFrameNumber);\n      this._statusMap[key].frameState = frameState;\n    }\n  }\n\n  /**\n   * Find request in the map\n   * @param key - unique key\n   * @returns\n   */\n  find(key) {\n    return this._statusMap[key];\n  }\n\n  /**\n   * Check it there are pending tile headers for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   * @returns\n   */\n  hasPendingTiles(viewportId: string, frameNumber: number): boolean {\n    return !this.pendingTilesRegister.isZero(viewportId, frameNumber);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}