{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _slicedToArray from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _classCallCheck from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _objectSpread from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { COORDINATE_SYSTEM, OPERATION } from './constants';\nimport AttributeManager from './attribute/attribute-manager';\nimport UniformTransitionManager from './uniform-transition-manager';\nimport { diffProps, validateProps as _validateProps } from '../lifecycle/props';\nimport { LIFECYCLE } from '../lifecycle/constants';\nimport { count } from '../utils/count';\nimport log from '../utils/log';\nimport debug from '../debug';\nimport { withParameters, setParameters } from '@luma.gl/core';\nimport assert from '../utils/assert';\nimport memoize from '../utils/memoize';\nimport { mergeShaders } from '../utils/shader';\nimport { projectPosition as _projectPosition, getWorldPosition } from '../shaderlib/project/project-functions';\nimport typedArrayManager from '../utils/typed-array-manager';\nimport Component from '../lifecycle/component';\nimport LayerState from './layer-state';\nimport { worldToPixels } from '@math.gl/web-mercator';\nimport { load } from '@loaders.gl/core';\nvar TRACE_CHANGE_FLAG = 'layer.changeFlag';\nvar TRACE_INITIALIZE = 'layer.initialize';\nvar TRACE_UPDATE = 'layer.update';\nvar TRACE_FINALIZE = 'layer.finalize';\nvar TRACE_MATCHED = 'layer.matched';\nvar MAX_PICKING_COLOR_CACHE_SIZE = Math.pow(2, 24) - 1;\nvar EMPTY_ARRAY = Object.freeze([]);\nvar areViewportsEqual = memoize(function (_ref2) {\n  var oldViewport = _ref2.oldViewport,\n    viewport = _ref2.viewport;\n  return oldViewport.equals(viewport);\n});\nvar pickingColorCache = new Uint8ClampedArray(0);\nvar defaultProps = {\n  data: {\n    type: 'data',\n    value: EMPTY_ARRAY,\n    async: true\n  },\n  dataComparator: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  _dataDiff: {\n    type: 'function',\n    value: function value(data) {\n      return data && data.__diff;\n    },\n    compare: false,\n    optional: true\n  },\n  dataTransform: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  onDataLoad: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  onError: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  fetch: {\n    type: 'function',\n    value: function value(url, _ref3) {\n      var propName = _ref3.propName,\n        layer = _ref3.layer,\n        loaders = _ref3.loaders,\n        loadOptions = _ref3.loadOptions,\n        signal = _ref3.signal;\n      var resourceManager = layer.context.resourceManager;\n      loadOptions = loadOptions || layer.getLoadOptions();\n      loaders = loaders || layer.props.loaders;\n      if (signal) {\n        var _loadOptions;\n        loadOptions = _objectSpread(_objectSpread({}, loadOptions), {}, {\n          fetch: _objectSpread(_objectSpread({}, (_loadOptions = loadOptions) === null || _loadOptions === void 0 ? void 0 : _loadOptions.fetch), {}, {\n            signal: signal\n          })\n        });\n      }\n      var inResourceManager = resourceManager.contains(url);\n      if (!inResourceManager && !loadOptions) {\n        resourceManager.add({\n          resourceId: url,\n          data: load(url, loaders),\n          persistent: false\n        });\n        inResourceManager = true;\n      }\n      if (inResourceManager) {\n        return resourceManager.subscribe({\n          resourceId: url,\n          onChange: function onChange(data) {\n            var _layer$internalState;\n            return (_layer$internalState = layer.internalState) === null || _layer$internalState === void 0 ? void 0 : _layer$internalState.reloadAsyncProp(propName, data);\n          },\n          consumerId: layer.id,\n          requestId: propName\n        });\n      }\n      return load(url, loaders, loadOptions);\n    },\n    compare: false\n  },\n  updateTriggers: {},\n  visible: true,\n  pickable: false,\n  opacity: {\n    type: 'number',\n    min: 0,\n    max: 1,\n    value: 1\n  },\n  operation: OPERATION.DRAW,\n  onHover: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  onClick: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  onDragStart: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  onDrag: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  onDragEnd: {\n    type: 'function',\n    value: null,\n    compare: false,\n    optional: true\n  },\n  coordinateSystem: COORDINATE_SYSTEM.DEFAULT,\n  coordinateOrigin: {\n    type: 'array',\n    value: [0, 0, 0],\n    compare: true\n  },\n  modelMatrix: {\n    type: 'array',\n    value: null,\n    compare: true,\n    optional: true\n  },\n  wrapLongitude: false,\n  positionFormat: 'XYZ',\n  colorFormat: 'RGBA',\n  parameters: {\n    type: 'object',\n    value: {},\n    optional: true,\n    compare: true\n  },\n  transitions: null,\n  extensions: [],\n  loaders: {\n    type: 'array',\n    value: [],\n    optional: true,\n    compare: true\n  },\n  getPolygonOffset: {\n    type: 'function',\n    value: function value(_ref4) {\n      var layerIndex = _ref4.layerIndex;\n      return [0, -layerIndex * 100];\n    },\n    compare: false\n  },\n  highlightedObjectIndex: null,\n  autoHighlight: false,\n  highlightColor: {\n    type: 'accessor',\n    value: [0, 0, 128, 128]\n  }\n};\nvar Layer = /*#__PURE__*/function (_Component) {\n  _inherits(Layer, _Component);\n  var _super = _createSuper(Layer);\n  function Layer() {\n    var _this;\n    _classCallCheck(this, Layer);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"internalState\", null);\n    _defineProperty(_assertThisInitialized(_this), \"lifecycle\", LIFECYCLE.NO_STATE);\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"state\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"parent\", null);\n    return _this;\n  }\n  _createClass(Layer, [{\n    key: \"root\",\n    get: function get() {\n      var layer = this;\n      while (layer.parent) {\n        layer = layer.parent;\n      }\n      return layer;\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var className = this.constructor.layerName || this.constructor.name;\n      return \"\".concat(className, \"({id: '\").concat(this.props.id, \"'})\");\n    }\n  }, {\n    key: \"project\",\n    value: function project(xyz) {\n      assert(this.internalState);\n      var viewport = this.internalState.viewport || this.context.viewport;\n      var worldPosition = getWorldPosition(xyz, {\n        viewport: viewport,\n        modelMatrix: this.props.modelMatrix,\n        coordinateOrigin: this.props.coordinateOrigin,\n        coordinateSystem: this.props.coordinateSystem\n      });\n      var _worldToPixels = worldToPixels(worldPosition, viewport.pixelProjectionMatrix),\n        _worldToPixels2 = _slicedToArray(_worldToPixels, 3),\n        x = _worldToPixels2[0],\n        y = _worldToPixels2[1],\n        z = _worldToPixels2[2];\n      return xyz.length === 2 ? [x, y] : [x, y, z];\n    }\n  }, {\n    key: \"unproject\",\n    value: function unproject(xy) {\n      assert(this.internalState);\n      var viewport = this.internalState.viewport || this.context.viewport;\n      return viewport.unproject(xy);\n    }\n  }, {\n    key: \"projectPosition\",\n    value: function projectPosition(xyz, params) {\n      assert(this.internalState);\n      var viewport = this.internalState.viewport || this.context.viewport;\n      return _projectPosition(xyz, _objectSpread({\n        viewport: viewport,\n        modelMatrix: this.props.modelMatrix,\n        coordinateOrigin: this.props.coordinateOrigin,\n        coordinateSystem: this.props.coordinateSystem\n      }, params));\n    }\n  }, {\n    key: \"isComposite\",\n    get: function get() {\n      return false;\n    }\n  }, {\n    key: \"setState\",\n    value: function setState(partialState) {\n      this.setChangeFlags({\n        stateChanged: true\n      });\n      Object.assign(this.state, partialState);\n      this.setNeedsRedraw();\n    }\n  }, {\n    key: \"setNeedsRedraw\",\n    value: function setNeedsRedraw() {\n      if (this.internalState) {\n        this.internalState.needsRedraw = true;\n      }\n    }\n  }, {\n    key: \"setNeedsUpdate\",\n    value: function setNeedsUpdate() {\n      if (this.internalState) {\n        this.context.layerManager.setNeedsUpdate(String(this));\n        this.internalState.needsUpdate = true;\n      }\n    }\n  }, {\n    key: \"isLoaded\",\n    get: function get() {\n      return this.internalState ? !this.internalState.isAsyncPropLoading() : false;\n    }\n  }, {\n    key: \"wrapLongitude\",\n    get: function get() {\n      return this.props.wrapLongitude;\n    }\n  }, {\n    key: \"isPickable\",\n    value: function isPickable() {\n      return this.props.pickable && this.props.visible;\n    }\n  }, {\n    key: \"getModels\",\n    value: function getModels() {\n      return this.state && (this.state.models || this.state.model && [this.state.model]) || [];\n    }\n  }, {\n    key: \"setModuleParameters\",\n    value: function setModuleParameters(moduleParameters) {\n      var _iterator = _createForOfIteratorHelper(this.getModels()),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var model = _step.value;\n          model.updateModuleSettings(moduleParameters);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }, {\n    key: \"getAttributeManager\",\n    value: function getAttributeManager() {\n      return this.internalState && this.internalState.attributeManager;\n    }\n  }, {\n    key: \"getCurrentLayer\",\n    value: function getCurrentLayer() {\n      return this.internalState && this.internalState.layer;\n    }\n  }, {\n    key: \"getLoadOptions\",\n    value: function getLoadOptions() {\n      return this.props.loadOptions;\n    }\n  }, {\n    key: \"use64bitPositions\",\n    value: function use64bitPositions() {\n      var coordinateSystem = this.props.coordinateSystem;\n      return coordinateSystem === COORDINATE_SYSTEM.DEFAULT || coordinateSystem === COORDINATE_SYSTEM.LNGLAT || coordinateSystem === COORDINATE_SYSTEM.CARTESIAN;\n    }\n  }, {\n    key: \"onHover\",\n    value: function onHover(info, pickingEvent) {\n      if (this.props.onHover) {\n        return this.props.onHover(info, pickingEvent) || false;\n      }\n      return false;\n    }\n  }, {\n    key: \"onClick\",\n    value: function onClick(info, pickingEvent) {\n      if (this.props.onClick) {\n        return this.props.onClick(info, pickingEvent) || false;\n      }\n      return false;\n    }\n  }, {\n    key: \"nullPickingColor\",\n    value: function nullPickingColor() {\n      return [0, 0, 0];\n    }\n  }, {\n    key: \"encodePickingColor\",\n    value: function encodePickingColor(i) {\n      var target = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n      target[0] = i + 1 & 255;\n      target[1] = i + 1 >> 8 & 255;\n      target[2] = i + 1 >> 8 >> 8 & 255;\n      return target;\n    }\n  }, {\n    key: \"decodePickingColor\",\n    value: function decodePickingColor(color) {\n      assert(color instanceof Uint8Array);\n      var _color = _slicedToArray(color, 3),\n        i1 = _color[0],\n        i2 = _color[1],\n        i3 = _color[2];\n      var index = i1 + i2 * 256 + i3 * 65536 - 1;\n      return index;\n    }\n  }, {\n    key: \"getNumInstances\",\n    value: function getNumInstances() {\n      if (Number.isFinite(this.props.numInstances)) {\n        return this.props.numInstances;\n      }\n      if (this.state && this.state.numInstances !== undefined) {\n        return this.state.numInstances;\n      }\n      return count(this.props.data);\n    }\n  }, {\n    key: \"getStartIndices\",\n    value: function getStartIndices() {\n      if (this.props.startIndices) {\n        return this.props.startIndices;\n      }\n      if (this.state && this.state.startIndices) {\n        return this.state.startIndices;\n      }\n      return null;\n    }\n  }, {\n    key: \"getBounds\",\n    value: function getBounds() {\n      var _ref;\n      var attributeManager = this.getAttributeManager();\n      if (!attributeManager) return null;\n      var _attributeManager$att = attributeManager.attributes,\n        positions = _attributeManager$att.positions,\n        instancePositions = _attributeManager$att.instancePositions;\n      return (_ref = positions || instancePositions) === null || _ref === void 0 ? void 0 : _ref.getBounds();\n    }\n  }, {\n    key: \"getShaders\",\n    value: function getShaders(shaders) {\n      var _iterator2 = _createForOfIteratorHelper(this.props.extensions),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var extension = _step2.value;\n          shaders = mergeShaders(shaders, extension.getShaders.call(this, extension));\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n      return shaders;\n    }\n  }, {\n    key: \"shouldUpdateState\",\n    value: function shouldUpdateState(params) {\n      return params.changeFlags.propsOrDataChanged;\n    }\n  }, {\n    key: \"updateState\",\n    value: function updateState(params) {\n      var attributeManager = this.getAttributeManager();\n      var dataChanged = params.changeFlags.dataChanged;\n      if (dataChanged && attributeManager) {\n        if (Array.isArray(dataChanged)) {\n          var _iterator3 = _createForOfIteratorHelper(dataChanged),\n            _step3;\n          try {\n            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n              var dataRange = _step3.value;\n              attributeManager.invalidateAll(dataRange);\n            }\n          } catch (err) {\n            _iterator3.e(err);\n          } finally {\n            _iterator3.f();\n          }\n        } else {\n          attributeManager.invalidateAll();\n        }\n      }\n      var props = params.props,\n        oldProps = params.oldProps;\n      var neededPickingBuffer = Number.isInteger(oldProps.highlightedObjectIndex) || oldProps.pickable;\n      var needPickingBuffer = Number.isInteger(props.highlightedObjectIndex) || props.pickable;\n      if (neededPickingBuffer !== needPickingBuffer && attributeManager) {\n        var _attributeManager$att2 = attributeManager.attributes,\n          pickingColors = _attributeManager$att2.pickingColors,\n          instancePickingColors = _attributeManager$att2.instancePickingColors;\n        var pickingColorsAttribute = pickingColors || instancePickingColors;\n        if (pickingColorsAttribute) {\n          if (needPickingBuffer && pickingColorsAttribute.constant) {\n            pickingColorsAttribute.constant = false;\n            attributeManager.invalidate(pickingColorsAttribute.id);\n          }\n          if (!pickingColorsAttribute.value && !needPickingBuffer) {\n            pickingColorsAttribute.constant = true;\n            pickingColorsAttribute.value = [0, 0, 0];\n          }\n        }\n      }\n    }\n  }, {\n    key: \"finalizeState\",\n    value: function finalizeState(context) {\n      var _iterator4 = _createForOfIteratorHelper(this.getModels()),\n        _step4;\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var model = _step4.value;\n          model.delete();\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n      var attributeManager = this.getAttributeManager();\n      if (attributeManager) {\n        attributeManager.finalize();\n      }\n      if (this.context) {\n        this.context.resourceManager.unsubscribe({\n          consumerId: this.id\n        });\n      }\n      if (this.internalState) {\n        this.internalState.uniformTransitions.clear();\n        this.internalState.finalize();\n      }\n    }\n  }, {\n    key: \"draw\",\n    value: function draw(opts) {\n      var _iterator5 = _createForOfIteratorHelper(this.getModels()),\n        _step5;\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var model = _step5.value;\n          model.draw(opts);\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n    }\n  }, {\n    key: \"getPickingInfo\",\n    value: function getPickingInfo(_ref5) {\n      var info = _ref5.info,\n        mode = _ref5.mode,\n        sourceLayer = _ref5.sourceLayer;\n      var index = info.index;\n      if (index >= 0) {\n        if (Array.isArray(this.props.data)) {\n          info.object = this.props.data[index];\n        }\n      }\n      return info;\n    }\n  }, {\n    key: \"raiseError\",\n    value: function raiseError(error, message) {\n      var _this$props$onError, _this$props;\n      if (message) {\n        error.message = \"\".concat(message, \": \").concat(error.message);\n      }\n      if (!((_this$props$onError = (_this$props = this.props).onError) !== null && _this$props$onError !== void 0 && _this$props$onError.call(_this$props, error))) {\n        var _this$context, _this$context$onError;\n        (_this$context = this.context) === null || _this$context === void 0 ? void 0 : (_this$context$onError = _this$context.onError) === null || _this$context$onError === void 0 ? void 0 : _this$context$onError.call(_this$context, error, this);\n      }\n    }\n  }, {\n    key: \"getNeedsRedraw\",\n    value: function getNeedsRedraw() {\n      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        clearRedrawFlags: false\n      };\n      return this._getNeedsRedraw(opts);\n    }\n  }, {\n    key: \"needsUpdate\",\n    value: function needsUpdate() {\n      if (!this.internalState) {\n        return false;\n      }\n      return this.internalState.needsUpdate || this.hasUniformTransition() || this.shouldUpdateState(this._getUpdateParams());\n    }\n  }, {\n    key: \"hasUniformTransition\",\n    value: function hasUniformTransition() {\n      var _this$internalState;\n      return ((_this$internalState = this.internalState) === null || _this$internalState === void 0 ? void 0 : _this$internalState.uniformTransitions.active) || false;\n    }\n  }, {\n    key: \"activateViewport\",\n    value: function activateViewport(viewport) {\n      if (!this.internalState) {\n        return;\n      }\n      var oldViewport = this.internalState.viewport;\n      this.internalState.viewport = viewport;\n      if (!oldViewport || !areViewportsEqual({\n        oldViewport: oldViewport,\n        viewport: viewport\n      })) {\n        this.setChangeFlags({\n          viewportChanged: true\n        });\n        if (this.isComposite) {\n          if (this.needsUpdate()) {\n            this.setNeedsUpdate();\n          }\n        } else {\n          this._update();\n        }\n      }\n    }\n  }, {\n    key: \"invalidateAttribute\",\n    value: function invalidateAttribute() {\n      var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'all';\n      var attributeManager = this.getAttributeManager();\n      if (!attributeManager) {\n        return;\n      }\n      if (name === 'all') {\n        attributeManager.invalidateAll();\n      } else {\n        attributeManager.invalidate(name);\n      }\n    }\n  }, {\n    key: \"updateAttributes\",\n    value: function updateAttributes(changedAttributes) {\n      var _iterator6 = _createForOfIteratorHelper(this.getModels()),\n        _step6;\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var model = _step6.value;\n          this._setModelAttributes(model, changedAttributes);\n        }\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n    }\n  }, {\n    key: \"_updateAttributes\",\n    value: function _updateAttributes() {\n      var attributeManager = this.getAttributeManager();\n      if (!attributeManager) {\n        return;\n      }\n      var props = this.props;\n      var numInstances = this.getNumInstances();\n      var startIndices = this.getStartIndices();\n      attributeManager.update({\n        data: props.data,\n        numInstances: numInstances,\n        startIndices: startIndices,\n        props: props,\n        transitions: props.transitions,\n        buffers: props.data.attributes,\n        context: this\n      });\n      var changedAttributes = attributeManager.getChangedAttributes({\n        clearChangedFlags: true\n      });\n      this.updateAttributes(changedAttributes);\n    }\n  }, {\n    key: \"_updateAttributeTransition\",\n    value: function _updateAttributeTransition() {\n      var attributeManager = this.getAttributeManager();\n      if (attributeManager) {\n        attributeManager.updateTransition();\n      }\n    }\n  }, {\n    key: \"_updateUniformTransition\",\n    value: function _updateUniformTransition() {\n      var uniformTransitions = this.internalState.uniformTransitions;\n      if (uniformTransitions.active) {\n        var propsInTransition = uniformTransitions.update();\n        var props = Object.create(this.props);\n        for (var key in propsInTransition) {\n          Object.defineProperty(props, key, {\n            value: propsInTransition[key]\n          });\n        }\n        return props;\n      }\n      return this.props;\n    }\n  }, {\n    key: \"calculateInstancePickingColors\",\n    value: function calculateInstancePickingColors(attribute, _ref6) {\n      var numInstances = _ref6.numInstances;\n      if (attribute.constant) {\n        return;\n      }\n      var cacheSize = Math.floor(pickingColorCache.length / 3);\n      this.internalState.usesPickingColorCache = true;\n      if (cacheSize < numInstances) {\n        if (numInstances > MAX_PICKING_COLOR_CACHE_SIZE) {\n          log.warn('Layer has too many data objects. Picking might not be able to distinguish all objects.')();\n        }\n        pickingColorCache = typedArrayManager.allocate(pickingColorCache, numInstances, {\n          size: 3,\n          copy: true,\n          maxCount: Math.max(numInstances, MAX_PICKING_COLOR_CACHE_SIZE)\n        });\n        var newCacheSize = Math.floor(pickingColorCache.length / 3);\n        var pickingColor = [];\n        for (var i = cacheSize; i < newCacheSize; i++) {\n          this.encodePickingColor(i, pickingColor);\n          pickingColorCache[i * 3 + 0] = pickingColor[0];\n          pickingColorCache[i * 3 + 1] = pickingColor[1];\n          pickingColorCache[i * 3 + 2] = pickingColor[2];\n        }\n      }\n      attribute.value = pickingColorCache.subarray(0, numInstances * 3);\n    }\n  }, {\n    key: \"_setModelAttributes\",\n    value: function _setModelAttributes(model, changedAttributes) {\n      var attributeManager = this.getAttributeManager();\n      var excludeAttributes = model.userData.excludeAttributes || {};\n      var shaderAttributes = attributeManager.getShaderAttributes(changedAttributes, excludeAttributes);\n      model.setAttributes(shaderAttributes);\n    }\n  }, {\n    key: \"disablePickingIndex\",\n    value: function disablePickingIndex(objectIndex) {\n      this._disablePickingIndex(objectIndex);\n    }\n  }, {\n    key: \"_disablePickingIndex\",\n    value: function _disablePickingIndex(objectIndex) {\n      var _this$getAttributeMan = this.getAttributeManager().attributes,\n        pickingColors = _this$getAttributeMan.pickingColors,\n        instancePickingColors = _this$getAttributeMan.instancePickingColors;\n      var colors = pickingColors || instancePickingColors;\n      if (!colors) {\n        return;\n      }\n      var start = colors.getVertexOffset(objectIndex);\n      var end = colors.getVertexOffset(objectIndex + 1);\n      colors.buffer.subData({\n        data: new Uint8Array(end - start),\n        offset: start\n      });\n    }\n  }, {\n    key: \"restorePickingColors\",\n    value: function restorePickingColors() {\n      var _this$getAttributeMan2 = this.getAttributeManager().attributes,\n        pickingColors = _this$getAttributeMan2.pickingColors,\n        instancePickingColors = _this$getAttributeMan2.instancePickingColors;\n      var colors = pickingColors || instancePickingColors;\n      if (!colors) {\n        return;\n      }\n      if (this.internalState.usesPickingColorCache && colors.value.buffer !== pickingColorCache.buffer) {\n        colors.value = pickingColorCache.subarray(0, colors.value.length);\n      }\n      colors.updateSubBuffer({\n        startOffset: 0\n      });\n    }\n  }, {\n    key: \"_initialize\",\n    value: function _initialize() {\n      assert(!this.internalState);\n      assert(Number.isFinite(this.props.coordinateSystem));\n      debug(TRACE_INITIALIZE, this);\n      var attributeManager = this._getAttributeManager();\n      if (attributeManager) {\n        attributeManager.addInstanced({\n          instancePickingColors: {\n            type: 5121,\n            size: 3,\n            noAlloc: true,\n            update: this.calculateInstancePickingColors\n          }\n        });\n      }\n      this.internalState = new LayerState({\n        attributeManager: attributeManager,\n        layer: this\n      });\n      this._clearChangeFlags();\n      this.state = {};\n      Object.defineProperty(this.state, 'attributeManager', {\n        get: function get() {\n          log.deprecated('layer.state.attributeManager', 'layer.getAttributeManager()')();\n          return attributeManager;\n        }\n      });\n      this.internalState.layer = this;\n      this.internalState.uniformTransitions = new UniformTransitionManager(this.context.timeline);\n      this.internalState.onAsyncPropUpdated = this._onAsyncPropUpdated.bind(this);\n      this.internalState.setAsyncProps(this.props);\n      this.initializeState(this.context);\n      var _iterator7 = _createForOfIteratorHelper(this.props.extensions),\n        _step7;\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var extension = _step7.value;\n          extension.initializeState.call(this, this.context, extension);\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n      this.setChangeFlags({\n        dataChanged: 'init',\n        propsChanged: 'init',\n        viewportChanged: true,\n        extensionsChanged: true\n      });\n      this._update();\n    }\n  }, {\n    key: \"_transferState\",\n    value: function _transferState(oldLayer) {\n      debug(TRACE_MATCHED, this, this === oldLayer);\n      var state = oldLayer.state,\n        internalState = oldLayer.internalState;\n      if (this === oldLayer) {\n        return;\n      }\n      this.internalState = internalState;\n      this.internalState.layer = this;\n      this.state = state;\n      this.internalState.setAsyncProps(this.props);\n      this._diffProps(this.props, this.internalState.getOldProps());\n    }\n  }, {\n    key: \"_update\",\n    value: function _update() {\n      var stateNeedsUpdate = this.needsUpdate();\n      debug(TRACE_UPDATE, this, stateNeedsUpdate);\n      if (!stateNeedsUpdate) {\n        return;\n      }\n      var currentProps = this.props;\n      var context = this.context;\n      var internalState = this.internalState;\n      var currentViewport = context.viewport;\n      var propsInTransition = this._updateUniformTransition();\n      internalState.propsInTransition = propsInTransition;\n      context.viewport = internalState.viewport || currentViewport;\n      this.props = propsInTransition;\n      try {\n        var updateParams = this._getUpdateParams();\n        var oldModels = this.getModels();\n        if (context.gl) {\n          this.updateState(updateParams);\n        } else {\n          try {\n            this.updateState(updateParams);\n          } catch (error) {}\n        }\n        var _iterator8 = _createForOfIteratorHelper(this.props.extensions),\n          _step8;\n        try {\n          for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n            var extension = _step8.value;\n            extension.updateState.call(this, updateParams, extension);\n          }\n        } catch (err) {\n          _iterator8.e(err);\n        } finally {\n          _iterator8.f();\n        }\n        var modelChanged = this.getModels()[0] !== oldModels[0];\n        this._postUpdate(updateParams, modelChanged);\n      } finally {\n        context.viewport = currentViewport;\n        this.props = currentProps;\n        this._clearChangeFlags();\n        internalState.needsUpdate = false;\n        internalState.resetOldProps();\n      }\n    }\n  }, {\n    key: \"_finalize\",\n    value: function _finalize() {\n      debug(TRACE_FINALIZE, this);\n      this.finalizeState(this.context);\n      var _iterator9 = _createForOfIteratorHelper(this.props.extensions),\n        _step9;\n      try {\n        for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n          var extension = _step9.value;\n          extension.finalizeState.call(this, extension);\n        }\n      } catch (err) {\n        _iterator9.e(err);\n      } finally {\n        _iterator9.f();\n      }\n    }\n  }, {\n    key: \"_drawLayer\",\n    value: function _drawLayer(_ref7) {\n      var _this2 = this;\n      var _ref7$moduleParameter = _ref7.moduleParameters,\n        moduleParameters = _ref7$moduleParameter === void 0 ? null : _ref7$moduleParameter,\n        _ref7$uniforms = _ref7.uniforms,\n        uniforms = _ref7$uniforms === void 0 ? {} : _ref7$uniforms,\n        _ref7$parameters = _ref7.parameters,\n        parameters = _ref7$parameters === void 0 ? {} : _ref7$parameters;\n      this._updateAttributeTransition();\n      var currentProps = this.props;\n      var context = this.context;\n      this.props = this.internalState.propsInTransition || currentProps;\n      var opacity = this.props.opacity;\n      uniforms.opacity = Math.pow(opacity, 1 / 2.2);\n      try {\n        if (moduleParameters) {\n          this.setModuleParameters(moduleParameters);\n        }\n        var getPolygonOffset = this.props.getPolygonOffset;\n        var offsets = getPolygonOffset && getPolygonOffset(uniforms) || [0, 0];\n        setParameters(context.gl, {\n          polygonOffset: offsets\n        });\n        withParameters(context.gl, parameters, function () {\n          var opts = {\n            moduleParameters: moduleParameters,\n            uniforms: uniforms,\n            parameters: parameters,\n            context: context\n          };\n          var _iterator10 = _createForOfIteratorHelper(_this2.props.extensions),\n            _step10;\n          try {\n            for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {\n              var extension = _step10.value;\n              extension.draw.call(_this2, opts, extension);\n            }\n          } catch (err) {\n            _iterator10.e(err);\n          } finally {\n            _iterator10.f();\n          }\n          _this2.draw(opts);\n        });\n      } finally {\n        this.props = currentProps;\n      }\n    }\n  }, {\n    key: \"getChangeFlags\",\n    value: function getChangeFlags() {\n      var _this$internalState2;\n      return (_this$internalState2 = this.internalState) === null || _this$internalState2 === void 0 ? void 0 : _this$internalState2.changeFlags;\n    }\n  }, {\n    key: \"setChangeFlags\",\n    value: function setChangeFlags(flags) {\n      if (!this.internalState) {\n        return;\n      }\n      var changeFlags = this.internalState.changeFlags;\n      for (var key in flags) {\n        if (flags[key]) {\n          var flagChanged = false;\n          switch (key) {\n            case 'dataChanged':\n              var dataChangedReason = flags[key];\n              var prevDataChangedReason = changeFlags[key];\n              if (dataChangedReason && Array.isArray(prevDataChangedReason)) {\n                changeFlags.dataChanged = Array.isArray(dataChangedReason) ? prevDataChangedReason.concat(dataChangedReason) : dataChangedReason;\n                flagChanged = true;\n              }\n            default:\n              if (!changeFlags[key]) {\n                changeFlags[key] = flags[key];\n                flagChanged = true;\n              }\n          }\n          if (flagChanged) {\n            debug(TRACE_CHANGE_FLAG, this, key, flags);\n          }\n        }\n      }\n      var propsOrDataChanged = Boolean(changeFlags.dataChanged || changeFlags.updateTriggersChanged || changeFlags.propsChanged || changeFlags.extensionsChanged);\n      changeFlags.propsOrDataChanged = propsOrDataChanged;\n      changeFlags.somethingChanged = propsOrDataChanged || changeFlags.viewportChanged || changeFlags.stateChanged;\n    }\n  }, {\n    key: \"_clearChangeFlags\",\n    value: function _clearChangeFlags() {\n      this.internalState.changeFlags = {\n        dataChanged: false,\n        propsChanged: false,\n        updateTriggersChanged: false,\n        viewportChanged: false,\n        stateChanged: false,\n        extensionsChanged: false,\n        propsOrDataChanged: false,\n        somethingChanged: false\n      };\n    }\n  }, {\n    key: \"_diffProps\",\n    value: function _diffProps(newProps, oldProps) {\n      var changeFlags = diffProps(newProps, oldProps);\n      if (changeFlags.updateTriggersChanged) {\n        for (var key in changeFlags.updateTriggersChanged) {\n          if (changeFlags.updateTriggersChanged[key]) {\n            this.invalidateAttribute(key);\n          }\n        }\n      }\n      if (changeFlags.transitionsChanged) {\n        for (var _key2 in changeFlags.transitionsChanged) {\n          var _newProps$transitions;\n          this.internalState.uniformTransitions.add(_key2, oldProps[_key2], newProps[_key2], (_newProps$transitions = newProps.transitions) === null || _newProps$transitions === void 0 ? void 0 : _newProps$transitions[_key2]);\n        }\n      }\n      return this.setChangeFlags(changeFlags);\n    }\n  }, {\n    key: \"validateProps\",\n    value: function validateProps() {\n      _validateProps(this.props);\n    }\n  }, {\n    key: \"updateAutoHighlight\",\n    value: function updateAutoHighlight(info) {\n      if (this.props.autoHighlight && !Number.isInteger(this.props.highlightedObjectIndex)) {\n        this._updateAutoHighlight(info);\n      }\n    }\n  }, {\n    key: \"_updateAutoHighlight\",\n    value: function _updateAutoHighlight(info) {\n      var pickingModuleParameters = {\n        pickingSelectedColor: info.picked ? info.color : null\n      };\n      var highlightColor = this.props.highlightColor;\n      if (info.picked && typeof highlightColor === 'function') {\n        pickingModuleParameters.pickingHighlightColor = highlightColor(info);\n      }\n      this.setModuleParameters(pickingModuleParameters);\n      this.setNeedsRedraw();\n    }\n  }, {\n    key: \"_getAttributeManager\",\n    value: function _getAttributeManager() {\n      var context = this.context;\n      return new AttributeManager(context.gl, {\n        id: this.props.id,\n        stats: context.stats,\n        timeline: context.timeline\n      });\n    }\n  }, {\n    key: \"_postUpdate\",\n    value: function _postUpdate(updateParams, forceUpdate) {\n      var props = updateParams.props,\n        oldProps = updateParams.oldProps;\n      this.setNeedsRedraw();\n      this._updateAttributes();\n      var model = this.state.model;\n      model === null || model === void 0 ? void 0 : model.setInstanceCount(this.getNumInstances());\n      var autoHighlight = props.autoHighlight,\n        highlightedObjectIndex = props.highlightedObjectIndex,\n        highlightColor = props.highlightColor;\n      if (forceUpdate || oldProps.autoHighlight !== autoHighlight || oldProps.highlightedObjectIndex !== highlightedObjectIndex || oldProps.highlightColor !== highlightColor) {\n        var parameters = {};\n        if (!autoHighlight) {\n          parameters.pickingSelectedColor = null;\n        }\n        if (Array.isArray(highlightColor)) {\n          parameters.pickingHighlightColor = highlightColor;\n        }\n        if (forceUpdate || highlightedObjectIndex !== oldProps.highlightedObjectIndex) {\n          parameters.pickingSelectedColor = Number.isFinite(highlightedObjectIndex) && highlightedObjectIndex >= 0 ? this.encodePickingColor(highlightedObjectIndex) : null;\n        }\n        this.setModuleParameters(parameters);\n      }\n    }\n  }, {\n    key: \"_getUpdateParams\",\n    value: function _getUpdateParams() {\n      return {\n        props: this.props,\n        oldProps: this.internalState.getOldProps(),\n        context: this.context,\n        changeFlags: this.internalState.changeFlags\n      };\n    }\n  }, {\n    key: \"_getNeedsRedraw\",\n    value: function _getNeedsRedraw(opts) {\n      if (!this.internalState) {\n        return false;\n      }\n      var redraw = false;\n      redraw = redraw || this.internalState.needsRedraw && this.id;\n      this.internalState.needsRedraw = this.internalState.needsRedraw && !opts.clearRedrawFlags;\n      var attributeManager = this.getAttributeManager();\n      var attributeManagerNeedsRedraw = attributeManager ? attributeManager.getNeedsRedraw(opts) : false;\n      redraw = redraw || attributeManagerNeedsRedraw;\n      return redraw;\n    }\n  }, {\n    key: \"_onAsyncPropUpdated\",\n    value: function _onAsyncPropUpdated() {\n      this._diffProps(this.props, this.internalState.getOldProps());\n      this.setNeedsUpdate();\n    }\n  }]);\n  return Layer;\n}(Component);\nexport { Layer as default };\n_defineProperty(Layer, \"defaultProps\", defaultProps);\n_defineProperty(Layer, \"layerName\", 'Layer');","map":{"version":3,"names":["COORDINATE_SYSTEM","OPERATION","AttributeManager","UniformTransitionManager","diffProps","validateProps","LIFECYCLE","count","log","debug","withParameters","setParameters","assert","memoize","mergeShaders","projectPosition","getWorldPosition","typedArrayManager","Component","LayerState","worldToPixels","load","TRACE_CHANGE_FLAG","TRACE_INITIALIZE","TRACE_UPDATE","TRACE_FINALIZE","TRACE_MATCHED","MAX_PICKING_COLOR_CACHE_SIZE","Math","pow","EMPTY_ARRAY","Object","freeze","areViewportsEqual","_ref2","oldViewport","viewport","equals","pickingColorCache","Uint8ClampedArray","defaultProps","data","type","value","async","dataComparator","compare","optional","_dataDiff","__diff","dataTransform","onDataLoad","onError","fetch","url","_ref3","propName","layer","loaders","loadOptions","signal","resourceManager","context","getLoadOptions","props","_loadOptions","_objectSpread","inResourceManager","contains","add","resourceId","persistent","subscribe","onChange","_layer$internalState","internalState","reloadAsyncProp","consumerId","id","requestId","updateTriggers","visible","pickable","opacity","min","max","operation","DRAW","onHover","onClick","onDragStart","onDrag","onDragEnd","coordinateSystem","DEFAULT","coordinateOrigin","modelMatrix","wrapLongitude","positionFormat","colorFormat","parameters","transitions","extensions","getPolygonOffset","_ref4","layerIndex","highlightedObjectIndex","autoHighlight","highlightColor","Layer","_Component","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","_defineProperty","_assertThisInitialized","NO_STATE","_createClass","key","get","parent","toString","className","constructor","layerName","name","project","xyz","worldPosition","_worldToPixels","pixelProjectionMatrix","_worldToPixels2","_slicedToArray","x","y","z","unproject","xy","params","setState","partialState","setChangeFlags","stateChanged","assign","state","setNeedsRedraw","needsRedraw","setNeedsUpdate","layerManager","String","needsUpdate","isAsyncPropLoading","isPickable","getModels","models","model","setModuleParameters","moduleParameters","_iterator","_createForOfIteratorHelper","_step","s","n","done","updateModuleSettings","err","e","f","getAttributeManager","attributeManager","getCurrentLayer","use64bitPositions","LNGLAT","CARTESIAN","info","pickingEvent","nullPickingColor","encodePickingColor","i","target","undefined","decodePickingColor","color","Uint8Array","_color","i1","i2","i3","index","getNumInstances","Number","isFinite","numInstances","getStartIndices","startIndices","getBounds","_ref","_attributeManager$att","attributes","positions","instancePositions","getShaders","shaders","_iterator2","_step2","extension","shouldUpdateState","changeFlags","propsOrDataChanged","updateState","dataChanged","isArray","_iterator3","_step3","dataRange","invalidateAll","oldProps","neededPickingBuffer","isInteger","needPickingBuffer","_attributeManager$att2","pickingColors","instancePickingColors","pickingColorsAttribute","constant","invalidate","finalizeState","_iterator4","_step4","delete","finalize","unsubscribe","uniformTransitions","clear","draw","opts","_iterator5","_step5","getPickingInfo","_ref5","mode","sourceLayer","object","raiseError","error","message","_this$props$onError","_this$props","_this$context","_this$context$onError","getNeedsRedraw","clearRedrawFlags","_getNeedsRedraw","hasUniformTransition","_getUpdateParams","_this$internalState","active","activateViewport","viewportChanged","isComposite","_update","invalidateAttribute","updateAttributes","changedAttributes","_iterator6","_step6","_setModelAttributes","_updateAttributes","update","buffers","getChangedAttributes","clearChangedFlags","_updateAttributeTransition","updateTransition","_updateUniformTransition","propsInTransition","create","defineProperty","calculateInstancePickingColors","attribute","_ref6","cacheSize","floor","usesPickingColorCache","warn","allocate","size","copy","maxCount","newCacheSize","pickingColor","subarray","excludeAttributes","userData","shaderAttributes","getShaderAttributes","setAttributes","disablePickingIndex","objectIndex","_disablePickingIndex","_this$getAttributeMan","colors","start","getVertexOffset","end","buffer","subData","offset","restorePickingColors","_this$getAttributeMan2","updateSubBuffer","startOffset","_initialize","_getAttributeManager","addInstanced","noAlloc","_clearChangeFlags","deprecated","timeline","onAsyncPropUpdated","_onAsyncPropUpdated","bind","setAsyncProps","initializeState","_iterator7","_step7","propsChanged","extensionsChanged","_transferState","oldLayer","_diffProps","getOldProps","stateNeedsUpdate","currentProps","currentViewport","updateParams","oldModels","gl","_iterator8","_step8","modelChanged","_postUpdate","resetOldProps","_finalize","_iterator9","_step9","_drawLayer","_ref7","_this2","_ref7$moduleParameter","_ref7$uniforms","uniforms","_ref7$parameters","offsets","polygonOffset","_iterator10","_step10","getChangeFlags","_this$internalState2","flags","flagChanged","dataChangedReason","prevDataChangedReason","Boolean","updateTriggersChanged","somethingChanged","newProps","transitionsChanged","_newProps$transitions","updateAutoHighlight","_updateAutoHighlight","pickingModuleParameters","pickingSelectedColor","picked","pickingHighlightColor","stats","forceUpdate","setInstanceCount","redraw","attributeManagerNeedsRedraw","default"],"sources":["/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@deck.gl/core/src/lib/layer.ts"],"sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable react/no-direct-mutation-state */\nimport {COORDINATE_SYSTEM, OPERATION} from './constants';\nimport AttributeManager from './attribute/attribute-manager';\nimport UniformTransitionManager from './uniform-transition-manager';\nimport {diffProps, validateProps} from '../lifecycle/props';\nimport {LIFECYCLE, Lifecycle} from '../lifecycle/constants';\nimport {count} from '../utils/count';\nimport log from '../utils/log';\nimport debug from '../debug';\nimport GL from '@luma.gl/constants';\nimport {withParameters, setParameters} from '@luma.gl/core';\nimport assert from '../utils/assert';\nimport memoize from '../utils/memoize';\nimport {mergeShaders} from '../utils/shader';\nimport {projectPosition, getWorldPosition} from '../shaderlib/project/project-functions';\nimport typedArrayManager from '../utils/typed-array-manager';\n\nimport Component from '../lifecycle/component';\nimport LayerState, {ChangeFlags} from './layer-state';\n\nimport {worldToPixels} from '@math.gl/web-mercator';\n\nimport {load} from '@loaders.gl/core';\n\nimport type {Loader} from '@loaders.gl/loader-utils';\nimport type {CoordinateSystem} from './constants';\nimport type Attribute from './attribute/attribute';\nimport type {Model} from '@luma.gl/engine';\nimport type {PickingInfo, GetPickingInfoParams} from './picking/pick-info';\nimport type Viewport from '../viewports/viewport';\nimport type {NumericArray} from '../types/types';\nimport type {DefaultProps} from '../lifecycle/prop-types';\nimport type {LayerProps} from '../types/layer-props';\nimport type {LayerContext} from './layer-manager';\n\nconst TRACE_CHANGE_FLAG = 'layer.changeFlag';\nconst TRACE_INITIALIZE = 'layer.initialize';\nconst TRACE_UPDATE = 'layer.update';\nconst TRACE_FINALIZE = 'layer.finalize';\nconst TRACE_MATCHED = 'layer.matched';\n\nconst MAX_PICKING_COLOR_CACHE_SIZE = 2 ** 24 - 1;\n\nconst EMPTY_ARRAY = Object.freeze([]);\n\n// Only compare the same two viewports once\nconst areViewportsEqual = memoize(\n  ({oldViewport, viewport}: {oldViewport: Viewport; viewport: Viewport}): boolean => {\n    return oldViewport.equals(viewport);\n  }\n);\n\nlet pickingColorCache = new Uint8ClampedArray(0);\n\nconst defaultProps: DefaultProps<LayerProps> = {\n  // data: Special handling for null, see below\n  data: {type: 'data', value: EMPTY_ARRAY, async: true},\n  dataComparator: {type: 'function', value: null, compare: false, optional: true},\n  _dataDiff: {\n    type: 'function',\n    // @ts-ignore __diff is not defined on data\n    value: data => data && data.__diff,\n    compare: false,\n    optional: true\n  },\n  dataTransform: {type: 'function', value: null, compare: false, optional: true},\n  onDataLoad: {type: 'function', value: null, compare: false, optional: true},\n  onError: {type: 'function', value: null, compare: false, optional: true},\n  fetch: {\n    type: 'function',\n    value: <LayerT extends Layer>(\n      url: string,\n      {\n        propName,\n        layer,\n        loaders,\n        loadOptions,\n        signal\n      }: {\n        propName: string;\n        layer: LayerT;\n        loaders?: Loader[];\n        loadOptions?: any;\n        signal?: AbortSignal;\n      }\n    ) => {\n      const {resourceManager} = layer.context;\n      loadOptions = loadOptions || layer.getLoadOptions();\n      loaders = loaders || layer.props.loaders;\n      if (signal) {\n        loadOptions = {\n          ...loadOptions,\n          fetch: {\n            ...loadOptions?.fetch,\n            signal\n          }\n        };\n      }\n\n      let inResourceManager = resourceManager.contains(url);\n\n      if (!inResourceManager && !loadOptions) {\n        // If there is no layer-specific load options, then attempt to cache this resource in the data manager\n        resourceManager.add({resourceId: url, data: load(url, loaders), persistent: false});\n        inResourceManager = true;\n      }\n      if (inResourceManager) {\n        return resourceManager.subscribe({\n          resourceId: url,\n          onChange: data => layer.internalState?.reloadAsyncProp(propName, data),\n          consumerId: layer.id,\n          requestId: propName\n        });\n      }\n\n      return load(url, loaders, loadOptions);\n    },\n    compare: false\n  },\n  updateTriggers: {}, // Update triggers: a core change detection mechanism in deck.gl\n\n  visible: true,\n  pickable: false,\n  opacity: {type: 'number', min: 0, max: 1, value: 1},\n  operation: OPERATION.DRAW,\n\n  onHover: {type: 'function', value: null, compare: false, optional: true},\n  onClick: {type: 'function', value: null, compare: false, optional: true},\n  onDragStart: {type: 'function', value: null, compare: false, optional: true},\n  onDrag: {type: 'function', value: null, compare: false, optional: true},\n  onDragEnd: {type: 'function', value: null, compare: false, optional: true},\n\n  coordinateSystem: COORDINATE_SYSTEM.DEFAULT,\n  coordinateOrigin: {type: 'array', value: [0, 0, 0], compare: true},\n  modelMatrix: {type: 'array', value: null, compare: true, optional: true},\n  wrapLongitude: false,\n  positionFormat: 'XYZ',\n  colorFormat: 'RGBA',\n\n  parameters: {type: 'object', value: {}, optional: true, compare: true},\n  transitions: null,\n  extensions: [],\n  loaders: {type: 'array', value: [], optional: true, compare: true},\n\n  // Offset depth based on layer index to avoid z-fighting.\n  // Negative values pull layer towards the camera\n  // https://www.opengl.org/archives/resources/faq/technical/polygonoffset.htm\n  getPolygonOffset: {\n    type: 'function',\n    value: ({layerIndex}) => [0, -layerIndex * 100],\n    compare: false\n  },\n\n  // Selection/Highlighting\n  highlightedObjectIndex: null,\n  autoHighlight: false,\n  highlightColor: {type: 'accessor', value: [0, 0, 128, 128]}\n};\n\nexport type UpdateParameters<LayerT extends Layer> = {\n  props: LayerT['props'];\n  oldProps: LayerT['props'];\n  context: LayerContext;\n  changeFlags: ChangeFlags;\n};\n\nexport default abstract class Layer<PropsT = {}> extends Component<PropsT & Required<LayerProps>> {\n  static defaultProps = defaultProps;\n  static layerName: string = 'Layer';\n\n  internalState: LayerState<this> | null = null;\n  lifecycle: Lifecycle = LIFECYCLE.NO_STATE; // Helps track and debug the life cycle of the layers\n\n  // context and state can technically be null before a layer is initialized/matched.\n  // However, they are most extensively accessed in a layer's lifecycle methods, where they are always defined.\n  // Checking for null state constantly in layer implementation is unnecessarily verbose.\n  context!: LayerContext; // Will reference layer manager's context, contains state shared by layers\n  state!: Record<string, any>; // Will be set to the shared layer state object during layer matching\n\n  parent: Layer | null = null;\n\n  get root(): Layer {\n    // eslint-disable-next-line\n    let layer: Layer = this;\n    while (layer.parent) {\n      layer = layer.parent;\n    }\n    return layer;\n  }\n\n  toString(): string {\n    const className = (this.constructor as typeof Layer).layerName || this.constructor.name;\n    return `${className}({id: '${this.props.id}'})`;\n  }\n\n  // Public API for users\n\n  /** Projects a point with current view state from the current layer's coordinate system to screen */\n  project(xyz: number[]): number[] {\n    assert(this.internalState);\n    const viewport = this.internalState.viewport || this.context.viewport;\n\n    const worldPosition = getWorldPosition(xyz, {\n      viewport,\n      modelMatrix: this.props.modelMatrix,\n      coordinateOrigin: this.props.coordinateOrigin,\n      coordinateSystem: this.props.coordinateSystem\n    });\n    const [x, y, z] = worldToPixels(worldPosition, viewport.pixelProjectionMatrix);\n    return xyz.length === 2 ? [x, y] : [x, y, z];\n  }\n\n  /** Unprojects a screen pixel to the current view's default coordinate system\n      Note: this does not reverse `project`. */\n  unproject(xy: number[]): number[] {\n    assert(this.internalState);\n    const viewport = this.internalState.viewport || this.context.viewport;\n    return viewport.unproject(xy);\n  }\n\n  /** Projects a point with current view state from the current layer's coordinate system to the world space */\n  projectPosition(\n    xyz: number[],\n    params?: {\n      /** The viewport to use */\n      viewport?: Viewport;\n      /** The coordinate system that the supplied position is in. Default to the same as `coordinateSystem`. */\n      fromCoordinateSystem?: CoordinateSystem;\n      /** The coordinate origin that the supplied position is in. Default to the same as `coordinateOrigin`. */\n      fromCoordinateOrigin?: [number, number, number];\n    }\n  ): [number, number, number] {\n    assert(this.internalState);\n    const viewport = this.internalState.viewport || this.context.viewport;\n\n    return projectPosition(xyz, {\n      viewport,\n      modelMatrix: this.props.modelMatrix,\n      coordinateOrigin: this.props.coordinateOrigin,\n      coordinateSystem: this.props.coordinateSystem,\n      ...params\n    });\n  }\n\n  // Public API for custom layer implementation\n\n  /** `true` if this layer renders other layers */\n  get isComposite(): boolean {\n    return false;\n  }\n\n  /** Updates selected state members and marks the layer for redraw */\n  setState(partialState: any): void {\n    this.setChangeFlags({stateChanged: true});\n    Object.assign(this.state, partialState);\n    this.setNeedsRedraw();\n  }\n\n  /** Sets the redraw flag for this layer, will trigger a redraw next animation frame */\n  setNeedsRedraw(): void {\n    if (this.internalState) {\n      this.internalState.needsRedraw = true;\n    }\n  }\n\n  /** Mark this layer as needs a deep update */\n  setNeedsUpdate() {\n    if (this.internalState) {\n      this.context.layerManager.setNeedsUpdate(String(this));\n      this.internalState.needsUpdate = true;\n    }\n  }\n\n  /** Returns true if all async resources are loaded */\n  get isLoaded(): boolean {\n    return this.internalState ? !this.internalState.isAsyncPropLoading() : false;\n  }\n\n  /** Returns true if using shader-based WGS84 longitude wrapping */\n  get wrapLongitude(): boolean {\n    return this.props.wrapLongitude;\n  }\n\n  /** Returns true if the layer is visible in the picking pass */\n  isPickable(): boolean {\n    return this.props.pickable && this.props.visible;\n  }\n\n  /** Returns an array of models used by this layer, can be overriden by layer subclass */\n  getModels(): Model[] {\n    return (this.state && (this.state.models || (this.state.model && [this.state.model]))) || [];\n  }\n\n  /** Update shader module parameters */\n  setModuleParameters(moduleParameters: any): void {\n    for (const model of this.getModels()) {\n      model.updateModuleSettings(moduleParameters);\n    }\n  }\n\n  /** Returns the attribute manager of this layer */\n  getAttributeManager(): AttributeManager | null {\n    return this.internalState && this.internalState.attributeManager;\n  }\n\n  /** Returns the most recent layer that matched to this state\n    (When reacting to an async event, this layer may no longer be the latest) */\n  getCurrentLayer(): Layer<PropsT> | null {\n    return this.internalState && this.internalState.layer;\n  }\n\n  /** Returns the default parse options for async props */\n  getLoadOptions(): any {\n    return this.props.loadOptions;\n  }\n\n  use64bitPositions(): boolean {\n    const {coordinateSystem} = this.props;\n    return (\n      coordinateSystem === COORDINATE_SYSTEM.DEFAULT ||\n      coordinateSystem === COORDINATE_SYSTEM.LNGLAT ||\n      coordinateSystem === COORDINATE_SYSTEM.CARTESIAN\n    );\n  }\n\n  // Event handling\n  onHover(info: PickingInfo, pickingEvent): boolean {\n    if (this.props.onHover) {\n      return this.props.onHover(info, pickingEvent) || false;\n    }\n    return false;\n  }\n\n  onClick(info: PickingInfo, pickingEvent): boolean {\n    if (this.props.onClick) {\n      return this.props.onClick(info, pickingEvent) || false;\n    }\n    return false;\n  }\n\n  // Returns the picking color that doesn't match any subfeature\n  // Use if some graphics do not belong to any pickable subfeature\n  // @return {Array} - a black color\n  nullPickingColor() {\n    return [0, 0, 0];\n  }\n\n  // Returns the picking color that doesn't match any subfeature\n  // Use if some graphics do not belong to any pickable subfeature\n  encodePickingColor(i, target: number[] = []): number[] {\n    target[0] = (i + 1) & 255;\n    target[1] = ((i + 1) >> 8) & 255;\n    target[2] = (((i + 1) >> 8) >> 8) & 255;\n    return target;\n  }\n\n  // Returns the index corresponding to a picking color that doesn't match any subfeature\n  // @param {Uint8Array} color - color array to be decoded\n  // @return {Array} - the decoded picking color\n  decodePickingColor(color) {\n    assert(color instanceof Uint8Array);\n    const [i1, i2, i3] = color;\n    // 1 was added to seperate from no selection\n    const index = i1 + i2 * 256 + i3 * 65536 - 1;\n    return index;\n  }\n\n  /** Deduces number of instances. Intention is to support:\n    - Explicit setting of numInstances\n    - Auto-deduction for ES6 containers that define a size member\n    - Auto-deduction for Classic Arrays via the built-in length attribute\n    - Auto-deduction via arrays */\n  getNumInstances(): number {\n    // First Check if app has provided an explicit value\n    if (Number.isFinite(this.props.numInstances)) {\n      return this.props.numInstances as number;\n    }\n\n    // Second check if the layer has set its own value\n    if (this.state && this.state.numInstances !== undefined) {\n      return this.state.numInstances;\n    }\n\n    // Use container library to get a count for any ES6 container or object\n    return count(this.props.data);\n  }\n\n  /** Buffer layout describes how many attribute values are packed for each data object\n      The default (null) is one value each object.\n      Some data formats (e.g. paths, polygons) have various length. Their buffer layout\n      is in the form of [L0, L1, L2, ...] */\n  getStartIndices(): NumericArray | null {\n    // First Check if startIndices is provided as an explicit value\n    if (this.props.startIndices) {\n      return this.props.startIndices;\n    }\n\n    // Second check if the layer has set its own value\n    if (this.state && this.state.startIndices) {\n      return this.state.startIndices;\n    }\n\n    return null;\n  }\n\n  // Default implementation\n  // Sublayers chould override this method to provide an accurate calculation of the bounds\n  getBounds(): [number[], number[]] | null {\n    const attributeManager = this.getAttributeManager();\n    if (!attributeManager) return null;\n    const {positions, instancePositions} = attributeManager.attributes;\n    return (positions || instancePositions)?.getBounds();\n  }\n\n  // / LIFECYCLE METHODS - overridden by the layer subclasses\n\n  /** Called once to set up the initial state. Layers can create WebGL resources here. */\n  abstract initializeState(context: LayerContext): void;\n\n  getShaders(shaders: any): any {\n    for (const extension of this.props.extensions) {\n      shaders = mergeShaders(shaders, extension.getShaders.call(this, extension));\n    }\n    return shaders;\n  }\n\n  /** Controls if updateState should be called. By default returns true if any prop has changed */\n  shouldUpdateState(params: UpdateParameters<Layer<PropsT>>): boolean {\n    return params.changeFlags.propsOrDataChanged;\n  }\n\n  /* eslint-disable-next-line complexity */\n  /** Default implementation, all attributes will be invalidated and updated when data changes */\n  updateState(params: UpdateParameters<Layer<PropsT>>): void {\n    const attributeManager = this.getAttributeManager();\n    const {dataChanged} = params.changeFlags;\n    if (dataChanged && attributeManager) {\n      if (Array.isArray(dataChanged)) {\n        // is partial update\n        for (const dataRange of dataChanged) {\n          attributeManager.invalidateAll(dataRange);\n        }\n      } else {\n        attributeManager.invalidateAll();\n      }\n    }\n\n    const {props, oldProps} = params;\n    const neededPickingBuffer =\n      Number.isInteger(oldProps.highlightedObjectIndex) || oldProps.pickable;\n    const needPickingBuffer = Number.isInteger(props.highlightedObjectIndex) || props.pickable;\n    if (neededPickingBuffer !== needPickingBuffer && attributeManager) {\n      const {pickingColors, instancePickingColors} = attributeManager.attributes;\n      const pickingColorsAttribute = pickingColors || instancePickingColors;\n      if (pickingColorsAttribute) {\n        if (needPickingBuffer && pickingColorsAttribute.constant) {\n          pickingColorsAttribute.constant = false;\n          attributeManager.invalidate(pickingColorsAttribute.id);\n        }\n        if (!pickingColorsAttribute.value && !needPickingBuffer) {\n          pickingColorsAttribute.constant = true;\n          pickingColorsAttribute.value = [0, 0, 0];\n        }\n      }\n    }\n  }\n\n  /** Called once when layer is no longer matched and state will be discarded. Layers can destroy WebGL resources here. */\n  finalizeState(context: LayerContext): void {\n    for (const model of this.getModels()) {\n      model.delete();\n    }\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      attributeManager.finalize();\n    }\n    if (this.context) {\n      this.context.resourceManager.unsubscribe({consumerId: this.id});\n    }\n    if (this.internalState) {\n      this.internalState.uniformTransitions.clear();\n      this.internalState.finalize();\n    }\n  }\n\n  // If state has a model, draw it with supplied uniforms\n  draw(opts) {\n    for (const model of this.getModels()) {\n      model.draw(opts);\n    }\n  }\n\n  // called to populate the info object that is passed to the event handler\n  // @return null to cancel event\n  getPickingInfo({info, mode, sourceLayer}: GetPickingInfoParams) {\n    const {index} = info;\n\n    if (index >= 0) {\n      // If props.data is an indexable array, get the object\n      if (Array.isArray(this.props.data)) {\n        info.object = this.props.data[index];\n      }\n    }\n\n    return info;\n  }\n\n  // END LIFECYCLE METHODS\n\n  // / INTERNAL METHODS - called by LayerManager, DeckRenderer and DeckPicker\n\n  /** (Internal) Propagate an error event through the system */\n  raiseError(error: Error, message: string): void {\n    if (message) {\n      error.message = `${message}: ${error.message}`;\n    }\n    if (!this.props.onError?.(error)) {\n      this.context?.onError?.(error, this);\n    }\n  }\n\n  /** (Internal) Checks if this layer needs redraw */\n  getNeedsRedraw(\n    opts: {\n      /** Reset redraw flags to false after the check */\n      clearRedrawFlags: boolean;\n    } = {clearRedrawFlags: false}\n  ): string | false {\n    return this._getNeedsRedraw(opts);\n  }\n\n  /** (Internal) Checks if this layer needs a deep update */\n  needsUpdate(): boolean {\n    if (!this.internalState) {\n      return false;\n    }\n\n    // Call subclass lifecycle method\n    return (\n      this.internalState.needsUpdate ||\n      this.hasUniformTransition() ||\n      this.shouldUpdateState(this._getUpdateParams())\n    );\n    // End lifecycle method\n  }\n\n  /** Checks if this layer has ongoing uniform transition */\n  hasUniformTransition(): boolean {\n    return this.internalState?.uniformTransitions.active || false;\n  }\n\n  /** Called when this layer is rendered into the given viewport */\n  activateViewport(viewport: Viewport): void {\n    if (!this.internalState) {\n      return;\n    }\n\n    const oldViewport = this.internalState.viewport;\n    this.internalState.viewport = viewport;\n\n    if (!oldViewport || !areViewportsEqual({oldViewport, viewport})) {\n      this.setChangeFlags({viewportChanged: true});\n\n      if (this.isComposite) {\n        if (this.needsUpdate()) {\n          // Composite layers may add/remove sublayers on viewport change\n          // Because we cannot change the layers list during a draw cycle, we don't want to update sublayers right away\n          // This will not call update immediately, but mark the layerManager as needs update on the next frame\n          this.setNeedsUpdate();\n        }\n      } else {\n        this._update();\n      }\n    }\n  }\n\n  /** Default implementation of attribute invalidation, can be redefined */\n  protected invalidateAttribute(name = 'all'): void {\n    const attributeManager = this.getAttributeManager();\n    if (!attributeManager) {\n      return;\n    }\n\n    if (name === 'all') {\n      attributeManager.invalidateAll();\n    } else {\n      attributeManager.invalidate(name);\n    }\n  }\n\n  /** Send updated attributes to the WebGL model */\n  protected updateAttributes(changedAttributes: {[id: string]: Attribute}) {\n    for (const model of this.getModels()) {\n      this._setModelAttributes(model, changedAttributes);\n    }\n  }\n\n  /** Recalculate any attributes if needed */\n  protected _updateAttributes(): void {\n    const attributeManager = this.getAttributeManager();\n    if (!attributeManager) {\n      return;\n    }\n    const props = this.props;\n\n    // Figure out data length\n    const numInstances = this.getNumInstances();\n    const startIndices = this.getStartIndices();\n\n    attributeManager.update({\n      data: props.data,\n      numInstances,\n      startIndices,\n      props,\n      transitions: props.transitions,\n      // @ts-ignore (TS2339) property attribute is not present on some acceptable data types\n      buffers: props.data.attributes,\n      context: this\n    });\n\n    const changedAttributes = attributeManager.getChangedAttributes({clearChangedFlags: true});\n    this.updateAttributes(changedAttributes);\n  }\n\n  /** Update attribute transitions. This is called in drawLayer, no model updates required. */\n  private _updateAttributeTransition() {\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      attributeManager.updateTransition();\n    }\n  }\n\n  /** Update uniform (prop) transitions. This is called in updateState, may result in model updates. */\n  private _updateUniformTransition(): Layer<PropsT>['props'] {\n    // @ts-ignore (TS2339) internalState is alwasy defined when this method is called\n    const {uniformTransitions} = this.internalState;\n    if (uniformTransitions.active) {\n      // clone props\n      const propsInTransition = uniformTransitions.update();\n      const props = Object.create(this.props);\n      for (const key in propsInTransition) {\n        Object.defineProperty(props, key, {value: propsInTransition[key]});\n      }\n      return props;\n    }\n    return this.props;\n  }\n\n  /** Updater for the automatically populated instancePickingColors attribute */\n  protected calculateInstancePickingColors(\n    attribute: Attribute,\n    {numInstances}: {numInstances: number}\n  ) {\n    if (attribute.constant) {\n      return;\n    }\n\n    // calculateInstancePickingColors always generates the same sequence.\n    // pickingColorCache saves the largest generated sequence for reuse\n    const cacheSize = Math.floor(pickingColorCache.length / 3);\n\n    // Record when using the picking buffer cache, so that layers can always point at the most recently allocated cache\n    // @ts-ignore (TS2531) internalState is always defined when this method is called\n    this.internalState.usesPickingColorCache = true;\n\n    if (cacheSize < numInstances) {\n      if (numInstances > MAX_PICKING_COLOR_CACHE_SIZE) {\n        log.warn(\n          'Layer has too many data objects. Picking might not be able to distinguish all objects.'\n        )();\n      }\n\n      pickingColorCache = typedArrayManager.allocate(pickingColorCache, numInstances, {\n        size: 3,\n        copy: true,\n        maxCount: Math.max(numInstances, MAX_PICKING_COLOR_CACHE_SIZE)\n      });\n\n      // If the attribute is larger than the cache, resize the cache and populate the missing chunk\n      const newCacheSize = Math.floor(pickingColorCache.length / 3);\n      const pickingColor = [];\n      for (let i = cacheSize; i < newCacheSize; i++) {\n        this.encodePickingColor(i, pickingColor);\n        pickingColorCache[i * 3 + 0] = pickingColor[0];\n        pickingColorCache[i * 3 + 1] = pickingColor[1];\n        pickingColorCache[i * 3 + 2] = pickingColor[2];\n      }\n    }\n\n    attribute.value = pickingColorCache.subarray(0, numInstances * 3);\n  }\n\n  /** Apply changed attributes to  */\n  protected _setModelAttributes(\n    model: Model,\n    changedAttributes: {\n      [id: string]: Attribute;\n    }\n  ) {\n    const attributeManager = this.getAttributeManager();\n    // @ts-ignore luma.gl type issue\n    const excludeAttributes = model.userData.excludeAttributes || {};\n    // @ts-ignore (TS2531) this method is only called internally with attributeManager defined\n    const shaderAttributes = attributeManager.getShaderAttributes(\n      changedAttributes,\n      excludeAttributes\n    );\n\n    model.setAttributes(shaderAttributes);\n  }\n\n  /** (Internal) Sets the picking color at the specified index to null picking color. Used for multi-depth picking.\n     This method may be overriden by layer implementations */\n  disablePickingIndex(objectIndex: number): void {\n    this._disablePickingIndex(objectIndex);\n  }\n\n  // TODO - simplify subclassing interface\n  protected _disablePickingIndex(objectIndex: number): void {\n    // @ts-ignore (TS2531) this method is only called internally with attributeManager defined\n    const {pickingColors, instancePickingColors} = this.getAttributeManager().attributes;\n    const colors = pickingColors || instancePickingColors;\n    if (!colors) {\n      return;\n    }\n\n    const start = colors.getVertexOffset(objectIndex);\n    const end = colors.getVertexOffset(objectIndex + 1);\n\n    // Fill the sub buffer with 0s\n    colors.buffer.subData({\n      data: new Uint8Array(end - start),\n      offset: start // 1 byte per element\n    });\n  }\n\n  /** (Internal) Re-enable all picking indices after multi-depth picking */\n  restorePickingColors(): void {\n    // @ts-ignore (TS2531) this method is only called internally with attributeManager defined\n    const {pickingColors, instancePickingColors} = this.getAttributeManager().attributes;\n    const colors = pickingColors || instancePickingColors;\n    if (!colors) {\n      return;\n    }\n    // The picking color cache may have been freed and then reallocated. This ensures we read from the currently allocated cache.\n    if (\n      // @ts-ignore (TS2531) this method is only called internally with internalState defined\n      this.internalState.usesPickingColorCache &&\n      (colors.value as Uint8ClampedArray).buffer !== pickingColorCache.buffer\n    ) {\n      colors.value = pickingColorCache.subarray(0, (colors.value as Uint8ClampedArray).length);\n    }\n    colors.updateSubBuffer({startOffset: 0});\n  }\n\n  /* eslint-disable max-statements */\n  /* (Internal) Called by layer manager when a new layer is found */\n  _initialize() {\n    assert(!this.internalState); // finalized layer cannot be reused\n    assert(Number.isFinite(this.props.coordinateSystem)); // invalid coordinateSystem\n\n    debug(TRACE_INITIALIZE, this);\n\n    const attributeManager = this._getAttributeManager();\n\n    if (attributeManager) {\n      // All instanced layers get instancePickingColors attribute by default\n      // Their shaders can use it to render a picking scene\n      // TODO - this slightly slows down non instanced layers\n      attributeManager.addInstanced({\n        instancePickingColors: {\n          type: GL.UNSIGNED_BYTE,\n          size: 3,\n          noAlloc: true,\n          // Updaters are always called with `this` pointing to the layer\n          // eslint-disable-next-line @typescript-eslint/unbound-method\n          update: this.calculateInstancePickingColors\n        }\n      });\n    }\n\n    this.internalState = new LayerState<this>({\n      attributeManager,\n      layer: this\n    });\n    this._clearChangeFlags(); // populate this.internalState.changeFlags\n\n    this.state = {};\n    // for backwards compatibility with older layers\n    // TODO - remove in next release\n    /* eslint-disable accessor-pairs */\n    Object.defineProperty(this.state, 'attributeManager', {\n      get: () => {\n        log.deprecated('layer.state.attributeManager', 'layer.getAttributeManager()')();\n        return attributeManager;\n      }\n    });\n    /* eslint-enable accessor-pairs */\n\n    this.internalState.layer = this;\n    this.internalState.uniformTransitions = new UniformTransitionManager(this.context.timeline);\n    this.internalState.onAsyncPropUpdated = this._onAsyncPropUpdated.bind(this);\n\n    // Ensure any async props are updated\n    this.internalState.setAsyncProps(this.props);\n\n    // Call subclass lifecycle methods\n    this.initializeState(this.context);\n\n    // Initialize extensions\n    for (const extension of this.props.extensions) {\n      extension.initializeState.call(this, this.context, extension);\n    }\n    // End subclass lifecycle methods\n\n    // initializeState callback tends to clear state\n    this.setChangeFlags({\n      dataChanged: 'init',\n      propsChanged: 'init',\n      viewportChanged: true,\n      extensionsChanged: true\n    });\n\n    this._update();\n  }\n\n  /** (Internal) Called by layer manager to transfer state from an old layer */\n  _transferState(oldLayer: Layer<PropsT>): void {\n    debug(TRACE_MATCHED, this, this === oldLayer);\n\n    const {state, internalState} = oldLayer;\n\n    if (this === oldLayer) {\n      return;\n    }\n\n    // Move internalState\n    this.internalState = internalState as LayerState<this>;\n    this.internalState.layer = this;\n\n    // Move state\n    this.state = state;\n    // We keep the state ref on old layers to support async actions\n    // oldLayer.state = null;\n\n    // Ensure any async props are updated\n    this.internalState.setAsyncProps(this.props);\n\n    this._diffProps(this.props, this.internalState.getOldProps() as Layer<PropsT>['props']);\n  }\n\n  /** (Internal) Called by layer manager when a new layer is added or an existing layer is matched with a new instance */\n  _update(): void {\n    // Call subclass lifecycle method\n    const stateNeedsUpdate = this.needsUpdate();\n    // End lifecycle method\n    debug(TRACE_UPDATE, this, stateNeedsUpdate);\n\n    if (!stateNeedsUpdate) {\n      return;\n    }\n\n    const currentProps = this.props;\n    const context = this.context;\n    const internalState = this.internalState as LayerState<this>;\n\n    const currentViewport = context.viewport;\n    const propsInTransition = this._updateUniformTransition();\n    internalState.propsInTransition = propsInTransition;\n    // Overwrite this.context.viewport during update to use the last activated viewport on this layer\n    // In multi-view applications, a layer may only be drawn in one of the views\n    // Which would make the \"active\" viewport different from the shared context\n    context.viewport = internalState.viewport || currentViewport;\n    // Overwrite this.props during update to use in-transition prop values\n    this.props = propsInTransition;\n\n    try {\n      const updateParams = this._getUpdateParams();\n      const oldModels = this.getModels();\n\n      // Safely call subclass lifecycle methods\n      if (context.gl) {\n        this.updateState(updateParams);\n      } else {\n        try {\n          this.updateState(updateParams);\n        } catch (error) {\n          // ignore error if gl context is missing\n        }\n      }\n      // Execute extension updates\n      for (const extension of this.props.extensions) {\n        extension.updateState.call(this, updateParams, extension);\n      }\n\n      const modelChanged = this.getModels()[0] !== oldModels[0];\n      this._postUpdate(updateParams, modelChanged);\n      // End subclass lifecycle methods\n    } finally {\n      // Restore shared context\n      context.viewport = currentViewport;\n      this.props = currentProps;\n      this._clearChangeFlags();\n      internalState.needsUpdate = false;\n      internalState.resetOldProps();\n    }\n  }\n  /* eslint-enable max-statements */\n\n  /** (Internal) Called by manager when layer is about to be disposed \n      Note: not guaranteed to be called on application shutdown */\n  _finalize(): void {\n    debug(TRACE_FINALIZE, this);\n\n    // Call subclass lifecycle method\n    this.finalizeState(this.context);\n    // Finalize extensions\n    for (const extension of this.props.extensions) {\n      extension.finalizeState.call(this, extension);\n    }\n  }\n\n  // Calculates uniforms\n  _drawLayer({\n    moduleParameters = null,\n    uniforms = {},\n    parameters = {}\n  }: {\n    moduleParameters: any;\n    uniforms: any;\n    parameters: any;\n  }): void {\n    this._updateAttributeTransition();\n\n    const currentProps = this.props;\n    const context = this.context;\n    // Overwrite this.props during redraw to use in-transition prop values\n    // `internalState.propsInTransition` could be missing if `updateState` failed\n    // @ts-ignore (TS2339) internalState is alwasy defined when this method is called\n    this.props = this.internalState.propsInTransition || currentProps;\n\n    const opacity = this.props.opacity;\n    // apply gamma to opacity to make it visually \"linear\"\n    uniforms.opacity = Math.pow(opacity, 1 / 2.2);\n\n    try {\n      // TODO/ib - hack move to luma Model.draw\n      if (moduleParameters) {\n        this.setModuleParameters(moduleParameters);\n      }\n\n      // Apply polygon offset to avoid z-fighting\n      // TODO - move to draw-layers\n      const {getPolygonOffset} = this.props;\n      const offsets = (getPolygonOffset && getPolygonOffset(uniforms)) || [0, 0];\n\n      setParameters(context.gl, {polygonOffset: offsets});\n\n      // Call subclass lifecycle method\n      withParameters(context.gl, parameters, () => {\n        const opts = {moduleParameters, uniforms, parameters, context};\n\n        // extensions\n        for (const extension of this.props.extensions) {\n          extension.draw.call(this, opts, extension);\n        }\n\n        this.draw(opts);\n      });\n    } finally {\n      this.props = currentProps;\n    }\n\n    // End lifecycle method\n  }\n\n  // Helper methods\n  /** Returns the current change flags */\n  getChangeFlags(): ChangeFlags | undefined {\n    return this.internalState?.changeFlags;\n  }\n\n  /* eslint-disable complexity */\n  /** Dirty some change flags, will be handled by updateLayer */\n  setChangeFlags(flags: Partial<ChangeFlags>): void {\n    if (!this.internalState) {\n      return;\n    }\n    const {changeFlags} = this.internalState;\n\n    /* eslint-disable no-fallthrough, max-depth */\n    for (const key in flags) {\n      if (flags[key]) {\n        let flagChanged = false;\n        switch (key) {\n          case 'dataChanged':\n            // changeFlags.dataChanged may be `false`, a string (reason) or an array of ranges\n            const dataChangedReason = flags[key];\n            const prevDataChangedReason = changeFlags[key];\n            if (dataChangedReason && Array.isArray(prevDataChangedReason)) {\n              // Merge partial updates\n              changeFlags.dataChanged = Array.isArray(dataChangedReason)\n                ? prevDataChangedReason.concat(dataChangedReason)\n                : dataChangedReason;\n              flagChanged = true;\n            }\n\n          default:\n            if (!changeFlags[key]) {\n              changeFlags[key] = flags[key];\n              flagChanged = true;\n            }\n        }\n        if (flagChanged) {\n          debug(TRACE_CHANGE_FLAG, this, key, flags);\n        }\n      }\n    }\n    /* eslint-enable no-fallthrough, max-depth */\n\n    // Update composite flags\n    const propsOrDataChanged = Boolean(\n      changeFlags.dataChanged ||\n        changeFlags.updateTriggersChanged ||\n        changeFlags.propsChanged ||\n        changeFlags.extensionsChanged\n    );\n    changeFlags.propsOrDataChanged = propsOrDataChanged;\n    changeFlags.somethingChanged =\n      propsOrDataChanged || changeFlags.viewportChanged || changeFlags.stateChanged;\n  }\n  /* eslint-enable complexity */\n\n  /** Clear all changeFlags, typically after an update */\n  private _clearChangeFlags(): void {\n    // @ts-ignore TS2531 this method can only be called internally with internalState assigned\n    this.internalState.changeFlags = {\n      dataChanged: false,\n      propsChanged: false,\n      updateTriggersChanged: false,\n      viewportChanged: false,\n      stateChanged: false,\n      extensionsChanged: false,\n      propsOrDataChanged: false,\n      somethingChanged: false\n    };\n  }\n\n  /** Compares the layers props with old props from a matched older layer\n      and extracts change flags that describe what has change so that state\n      can be update correctly with minimal effort */\n  private _diffProps(newProps: Layer<PropsT>['props'], oldProps: Layer<PropsT>['props']) {\n    const changeFlags = diffProps(newProps, oldProps);\n\n    // iterate over changedTriggers\n    if (changeFlags.updateTriggersChanged) {\n      for (const key in changeFlags.updateTriggersChanged) {\n        if (changeFlags.updateTriggersChanged[key]) {\n          this.invalidateAttribute(key);\n        }\n      }\n    }\n\n    // trigger uniform transitions\n    if (changeFlags.transitionsChanged) {\n      for (const key in changeFlags.transitionsChanged) {\n        // prop changed and transition is enabled\n        // @ts-ignore (TS2531) internalState is always defined when this method is called\n        this.internalState.uniformTransitions.add(\n          key,\n          oldProps[key],\n          newProps[key],\n          newProps.transitions?.[key]\n        );\n      }\n    }\n\n    return this.setChangeFlags(changeFlags);\n  }\n\n  /** (Internal) called by layer manager to perform extra props validation (in development only) */\n  validateProps(): void {\n    validateProps(this.props);\n  }\n\n  /** (Internal) Called by deck picker when the hovered object changes to update the auto highlight */\n  updateAutoHighlight(info: PickingInfo): void {\n    if (this.props.autoHighlight && !Number.isInteger(this.props.highlightedObjectIndex)) {\n      this._updateAutoHighlight(info);\n    }\n  }\n\n  // May be overriden by subclasses\n\n  // TODO - simplify subclassing interface\n  /** Update picking module parameters to highlight the hovered object */\n  protected _updateAutoHighlight(info: PickingInfo): void {\n    const pickingModuleParameters: any = {\n      pickingSelectedColor: info.picked ? info.color : null\n    };\n    const {highlightColor} = this.props;\n    if (info.picked && typeof highlightColor === 'function') {\n      pickingModuleParameters.pickingHighlightColor = highlightColor(info);\n    }\n    this.setModuleParameters(pickingModuleParameters);\n    // setModuleParameters does not trigger redraw\n    this.setNeedsRedraw();\n  }\n\n  /** Create new attribute manager */\n  protected _getAttributeManager(): AttributeManager | null {\n    const context = this.context;\n    return new AttributeManager(context.gl, {\n      id: this.props.id,\n      stats: context.stats,\n      timeline: context.timeline\n    });\n  }\n\n  // Private methods\n\n  /** Called after updateState to perform common tasks */\n  protected _postUpdate(updateParams: UpdateParameters<Layer<PropsT>>, forceUpdate: boolean) {\n    const {props, oldProps} = updateParams;\n\n    this.setNeedsRedraw();\n    // Check if attributes need recalculation\n    this._updateAttributes();\n\n    // Note: Automatic instance count update only works for single layers\n    const {model} = this.state;\n    model?.setInstanceCount(this.getNumInstances());\n\n    // Set picking module parameters to match props\n    const {autoHighlight, highlightedObjectIndex, highlightColor} = props;\n    if (\n      forceUpdate ||\n      oldProps.autoHighlight !== autoHighlight ||\n      oldProps.highlightedObjectIndex !== highlightedObjectIndex ||\n      oldProps.highlightColor !== highlightColor\n    ) {\n      const parameters: any = {};\n      if (!autoHighlight) {\n        parameters.pickingSelectedColor = null;\n      }\n      if (Array.isArray(highlightColor)) {\n        parameters.pickingHighlightColor = highlightColor;\n      }\n\n      // highlightedObjectIndex will overwrite any settings from auto highlighting.\n      // Do not reset unless the value has changed.\n      if (forceUpdate || highlightedObjectIndex !== oldProps.highlightedObjectIndex) {\n        parameters.pickingSelectedColor =\n          Number.isFinite(highlightedObjectIndex) && (highlightedObjectIndex as number) >= 0\n            ? this.encodePickingColor(highlightedObjectIndex)\n            : null;\n      }\n\n      this.setModuleParameters(parameters);\n    }\n  }\n\n  private _getUpdateParams(): UpdateParameters<Layer<PropsT>> {\n    return {\n      props: this.props,\n      // @ts-ignore TS2531 this method can only be called internally with internalState assigned\n      oldProps: this.internalState.getOldProps() as PropsT,\n      context: this.context,\n      // @ts-ignore TS2531 this method can only be called internally with internalState assigned\n      changeFlags: this.internalState.changeFlags\n    };\n  }\n\n  /** Checks state of attributes and model */\n  private _getNeedsRedraw(opts: {clearRedrawFlags: boolean}): string | false {\n    // this method may be called by the render loop as soon a the layer\n    // has been created, so guard against uninitialized state\n    if (!this.internalState) {\n      return false;\n    }\n\n    let redraw: string | false = false;\n    redraw = redraw || (this.internalState.needsRedraw && this.id);\n    this.internalState.needsRedraw = this.internalState.needsRedraw && !opts.clearRedrawFlags;\n\n    // TODO - is attribute manager needed? - Model should be enough.\n    const attributeManager = this.getAttributeManager();\n    const attributeManagerNeedsRedraw = attributeManager\n      ? attributeManager.getNeedsRedraw(opts)\n      : false;\n    redraw = redraw || attributeManagerNeedsRedraw;\n\n    return redraw;\n  }\n\n  /** Callback when asyn prop is loaded */\n  private _onAsyncPropUpdated(): void {\n    // @ts-ignore TS2531 this method can only be called internally with internalState assigned\n    this._diffProps(this.props, this.internalState.getOldProps());\n    this.setNeedsUpdate();\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}