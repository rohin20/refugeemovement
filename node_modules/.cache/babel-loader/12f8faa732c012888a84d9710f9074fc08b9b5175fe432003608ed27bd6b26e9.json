{"ast":null,"code":"// Copyright (c) 2022 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getTileData = getTileData;\nexports.decodeTile = decodeTile;\nexports.vectorTileFeatureToProp = vectorTileFeatureToProp;\nvar _pbf = _interopRequireDefault(require(\"pbf\"));\nvar _vectorTile = require(\"@mapbox/vector-tile\");\nvar _viewportMercatorProject = require(\"viewport-mercator-project\"); /* global fetch */\nvar TILE_SIZE = 512;\nvar MAPBOX_HOST = 'https://a.tiles.mapbox.com';\nvar MAP_SOURCE = '/v4/mapbox.mapbox-streets-v7';\nfunction getTileData(host, token, _ref) {\n  var x = _ref.x,\n    y = _ref.y,\n    z = _ref.z;\n  var mapSource = \"\".concat(host || MAPBOX_HOST).concat(MAP_SOURCE, \"/\").concat(z, \"/\").concat(x, \"/\").concat(y, \".vector.pbf?access_token=\").concat(token);\n  return fetch(mapSource).then(function (response) {\n    return response.arrayBuffer();\n  }).then(function (buffer) {\n    return decodeTile(x, y, z, buffer);\n  });\n}\nfunction decodeTile(x, y, z, arrayBuffer) {\n  var tile = new _vectorTile.VectorTile(new _pbf[\"default\"](arrayBuffer));\n  var result = [];\n  var xProj = x * TILE_SIZE;\n  var yProj = y * TILE_SIZE;\n  var scale = Math.pow(2, z);\n  var projectFunc = project.bind(null, xProj, yProj, scale);\n  /* eslint-disable guard-for-in */\n\n  var layerName = 'building';\n  var vectorTileLayer = tile.layers[layerName];\n  if (!vectorTileLayer) {\n    return [];\n  }\n  for (var i = 0; i < vectorTileLayer.length; i++) {\n    var vectorTileFeature = vectorTileLayer.feature(i);\n    var features = vectorTileFeatureToProp(vectorTileFeature, projectFunc);\n    features.forEach(function (f) {\n      f.properties.layer = layerName;\n      if (f.properties.height) {\n        result.push(f);\n      }\n    });\n  }\n  return result;\n}\nfunction project(x, y, scale, line, extent) {\n  var sizeToPixel = extent / TILE_SIZE;\n  for (var ii = 0; ii < line.length; ii++) {\n    var p = line[ii]; // LNGLAT\n\n    line[ii] = (0, _viewportMercatorProject.worldToLngLat)([x + p[0] / sizeToPixel, y + p[1] / sizeToPixel], scale);\n  }\n}\n/* adapted from @mapbox/vector-tile/lib/vectortilefeature.js for better perf */\n\n/* eslint-disable */\n\nfunction vectorTileFeatureToProp(vectorTileFeature, project) {\n  var coords = getCoordinates(vectorTileFeature);\n  var extent = vectorTileFeature.extent;\n  var i;\n  var j;\n  coords = classifyRings(coords);\n  for (i = 0; i < coords.length; i++) {\n    for (j = 0; j < coords[i].length; j++) {\n      project(coords[i][j], extent);\n    }\n  }\n  return coords.map(function (coordinates) {\n    return {\n      coordinates: coordinates,\n      properties: vectorTileFeature.properties\n    };\n  });\n}\nfunction getCoordinates(vectorTileFeature) {\n  var pbf = vectorTileFeature._pbf;\n  pbf.pos = vectorTileFeature._geometry;\n  var end = pbf.readVarint() + pbf.pos;\n  var cmd = 1;\n  var length = 0;\n  var x = 0;\n  var y = 0;\n  var lines = [];\n  var line;\n  while (pbf.pos < end) {\n    if (length <= 0) {\n      var cmdLen = pbf.readVarint();\n      cmd = cmdLen & 0x7;\n      length = cmdLen >> 3;\n    }\n    length--;\n    if (cmd === 1 || cmd === 2) {\n      x += pbf.readSVarint();\n      y += pbf.readSVarint();\n      if (cmd === 1) {\n        // moveTo\n        if (line) lines.push(line);\n        line = [];\n      }\n      if (line) line.push([x, y]);\n    } else if (cmd === 7) {\n      // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n      if (line) {\n        line.push(line[0].slice()); // closePolygon\n      }\n    } else {\n      throw new Error(\"unknown command \".concat(cmd));\n    }\n  }\n  if (line) lines.push(line);\n  return lines;\n} // classifies an array of rings into polygons with outer rings and holes\n\nfunction classifyRings(rings) {\n  var len = rings.length;\n  if (len <= 1) return [rings];\n  var polygons = [];\n  var polygon;\n  var ccw;\n  for (var i = 0; i < len; i++) {\n    var area = signedArea(rings[i]);\n    if (area === 0) {\n      continue;\n    }\n    if (ccw === undefined) {\n      ccw = area < 0;\n    }\n    if (ccw === area < 0) {\n      if (polygon) {\n        polygons.push(polygon);\n      }\n      polygon = [rings[i]];\n    } else if (polygon) {\n      polygon.push(rings[i]);\n    }\n  }\n  if (polygon) {\n    polygons.push(polygon);\n  }\n  return polygons;\n}\nfunction signedArea(ring) {\n  var sum = 0;\n  for (var i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n    p1 = ring[i];\n    p2 = ring[j];\n    sum += (p2[0] - p1[0]) * (p1[1] + p2[1]);\n  }\n  return sum;\n}","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","getTileData","decodeTile","vectorTileFeatureToProp","_pbf","_vectorTile","_viewportMercatorProject","MAPBOX_HOST","MAP_SOURCE","host","token","_ref","y","z","mapSource","concat","x","fetch","then","response","arrayBuffer","buffer","result","xProj","TILE_SIZE","yProj","scale","Math","pow","projectFunc","project","bind","layerName","vectorTileLayer","i","length","features","vectorTileFeature","forEach","f","properties","layer","height","line","extent","ii","worldToLngLat","p","sizeToPixel","j","coords","classifyRings","map","coordinates","getCoordinates","pbf","pos","_geometry","end","readVarint","cmd","lines","cmdLen","readSVarint","push","slice","Error","len","rings","polygons","polygon","ccw","area","undefined","signedArea","ring","p1","p2","sum"],"sources":["/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@kepler.gl/deckgl-layers/src/3d-building-layer/3d-building-utils.ts"],"sourcesContent":["// Copyright (c) 2022 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport Protobuf from 'pbf';\nimport {VectorTile} from '@mapbox/vector-tile';\nimport {worldToLngLat} from 'viewport-mercator-project';\nimport {\n  Coordinates,\n  FlatFigure,\n  TileDataItem,\n  VectorTileFeature,\n  VectorTileFeatureProperties\n} from './types';\n\n/* global fetch */\nconst TILE_SIZE = 512;\nconst MAPBOX_HOST = 'https://a.tiles.mapbox.com';\nconst MAP_SOURCE = '/v4/mapbox.mapbox-streets-v7';\n\nexport function getTileData(\n  host: string,\n  token: string,\n  {x, y, z}: Coordinates\n): Promise<TileDataItem[]> {\n  const mapSource = `${host ||\n    MAPBOX_HOST}${MAP_SOURCE}/${z}/${x}/${y}.vector.pbf?access_token=${token}`;\n\n  return fetch(mapSource)\n    .then(response => response.arrayBuffer())\n    .then(buffer => decodeTile(x, y, z, buffer));\n}\n\nexport function decodeTile(\n  x: number,\n  y: number,\n  z: number,\n  arrayBuffer: ArrayBuffer\n): TileDataItem[] {\n  const tile = new VectorTile(new Protobuf(arrayBuffer));\n\n  const result: TileDataItem[] = [];\n  const xProj = x * TILE_SIZE;\n  const yProj = y * TILE_SIZE;\n  const scale = Math.pow(2, z);\n\n  const projectFunc = project.bind(null, xProj, yProj, scale);\n\n  /* eslint-disable guard-for-in */\n  const layerName = 'building';\n  const vectorTileLayer = tile.layers[layerName];\n  if (!vectorTileLayer) {\n    return [];\n  }\n  for (let i = 0; i < vectorTileLayer.length; i++) {\n    const vectorTileFeature = vectorTileLayer.feature(i);\n    const features = vectorTileFeatureToProp(vectorTileFeature, projectFunc);\n    features.forEach(f => {\n      f.properties.layer = layerName;\n      if (f.properties.height) {\n        result.push(f);\n      }\n    });\n  }\n  return result;\n}\n\nfunction project(x: number, y: number, scale: number, line: FlatFigure, extent: number): void {\n  const sizeToPixel = extent / TILE_SIZE;\n\n  for (let ii = 0; ii < line.length; ii++) {\n    const p = line[ii];\n    // LNGLAT\n    line[ii] = worldToLngLat([x + p[0] / sizeToPixel, y + p[1] / sizeToPixel], scale);\n  }\n}\n\n/* adapted from @mapbox/vector-tile/lib/vectortilefeature.js for better perf */\n/* eslint-disable */\nexport function vectorTileFeatureToProp(\n  vectorTileFeature: VectorTileFeature,\n  project: (r: FlatFigure, n: number) => void\n): {coordinates: FlatFigure[]; properties: VectorTileFeatureProperties}[] {\n  let coords: FlatFigure[][] | FlatFigure[] = getCoordinates(vectorTileFeature);\n  const extent = vectorTileFeature.extent;\n  let i: number;\n  let j: number;\n\n  coords = classifyRings(coords);\n  for (i = 0; i < coords.length; i++) {\n    for (j = 0; j < coords[i].length; j++) {\n      project(coords[i][j], extent);\n    }\n  }\n\n  return coords.map(coordinates => ({\n    coordinates,\n    properties: vectorTileFeature.properties\n  }));\n}\n\nfunction getCoordinates(vectorTileFeature: VectorTileFeature): FlatFigure[] {\n  const pbf = vectorTileFeature._pbf;\n  pbf.pos = vectorTileFeature._geometry;\n\n  const end = pbf.readVarint() + pbf.pos;\n  let cmd = 1;\n  let length = 0;\n  let x = 0;\n  let y = 0;\n\n  const lines: FlatFigure[] = [];\n  let line: FlatFigure | undefined;\n\n  while (pbf.pos < end) {\n    if (length <= 0) {\n      const cmdLen = pbf.readVarint();\n      cmd = cmdLen & 0x7;\n      length = cmdLen >> 3;\n    }\n\n    length--;\n\n    if (cmd === 1 || cmd === 2) {\n      x += pbf.readSVarint();\n      y += pbf.readSVarint();\n\n      if (cmd === 1) {\n        // moveTo\n        if (line) lines.push(line);\n        line = [];\n      }\n\n      if (line) line.push([x, y]);\n    } else if (cmd === 7) {\n      // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n      if (line) {\n        line.push(line[0].slice() as [number, number] | [number, number, number]); // closePolygon\n      }\n    } else {\n      throw new Error(`unknown command ${cmd}`);\n    }\n  }\n\n  if (line) lines.push(line);\n\n  return lines;\n}\n\n// classifies an array of rings into polygons with outer rings and holes\n\nfunction classifyRings(rings: FlatFigure[]): FlatFigure[][] {\n  const len = rings.length;\n\n  if (len <= 1) return [rings];\n\n  const polygons: FlatFigure[][] = [];\n  let polygon: FlatFigure[] | undefined;\n  let ccw: boolean | undefined;\n\n  for (let i = 0; i < len; i++) {\n    const area = signedArea(rings[i]);\n    if (area === 0) {\n      continue;\n    }\n\n    if (ccw === undefined) {\n      ccw = area < 0;\n    }\n\n    if (ccw === area < 0) {\n      if (polygon) {\n        polygons.push(polygon);\n      }\n      polygon = [rings[i]];\n    } else if (polygon) {\n      polygon.push(rings[i]);\n    }\n  }\n  if (polygon) {\n    polygons.push(polygon);\n  }\n\n  return polygons;\n}\n\nfunction signedArea(ring: FlatFigure): number {\n  let sum = 0;\n  for (let i = 0, len = ring.length, j = len - 1, p1: number[], p2: number[]; i < len; j = i++) {\n    p1 = ring[i];\n    p2 = ring[j];\n    sum += (p2[0] - p1[0]) * (p1[1] + p2[1]);\n  }\n  return sum;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}