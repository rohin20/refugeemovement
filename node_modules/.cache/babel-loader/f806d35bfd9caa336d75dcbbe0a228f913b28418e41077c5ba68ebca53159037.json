{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { isResponse } from '../../javascript-utils/is-type';\nimport { getResourceContentLength, getResourceUrlAndType } from './resource-utils';\nexport function makeResponse(_x) {\n  return _makeResponse.apply(this, arguments);\n}\nfunction _makeResponse() {\n  _makeResponse = _asyncToGenerator(_regeneratorRuntime.mark(function _callee(resource) {\n    var headers, contentLength, _getResourceUrlAndTyp, url, type, initialDataUrl, response;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!isResponse(resource)) {\n              _context.next = 2;\n              break;\n            }\n            return _context.abrupt(\"return\", resource);\n          case 2:\n            headers = {};\n            contentLength = getResourceContentLength(resource);\n            if (contentLength >= 0) {\n              headers['content-length'] = String(contentLength);\n            }\n            _getResourceUrlAndTyp = getResourceUrlAndType(resource), url = _getResourceUrlAndTyp.url, type = _getResourceUrlAndTyp.type;\n            if (type) {\n              headers['content-type'] = type;\n            }\n            _context.next = 9;\n            return getInitialDataUrl(resource);\n          case 9:\n            initialDataUrl = _context.sent;\n            if (initialDataUrl) {\n              headers['x-first-bytes'] = initialDataUrl;\n            }\n            if (typeof resource === 'string') {\n              resource = new TextEncoder().encode(resource);\n            }\n            response = new Response(resource, {\n              headers: headers\n            });\n            Object.defineProperty(response, 'url', {\n              value: url\n            });\n            return _context.abrupt(\"return\", response);\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _makeResponse.apply(this, arguments);\n}\nexport function checkResponse(_x2) {\n  return _checkResponse.apply(this, arguments);\n}\nfunction _checkResponse() {\n  _checkResponse = _asyncToGenerator(_regeneratorRuntime.mark(function _callee2(response) {\n    var message;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (response.ok) {\n              _context2.next = 5;\n              break;\n            }\n            _context2.next = 3;\n            return getResponseError(response);\n          case 3:\n            message = _context2.sent;\n            throw new Error(message);\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _checkResponse.apply(this, arguments);\n}\nexport function checkResponseSync(response) {\n  if (!response.ok) {\n    var message = \"\".concat(response.status, \" \").concat(response.statusText);\n    message = message.length > 60 ? \"\".concat(message.slice(60), \"...\") : message;\n    throw new Error(message);\n  }\n}\nfunction getResponseError(_x3) {\n  return _getResponseError.apply(this, arguments);\n}\nfunction _getResponseError() {\n  _getResponseError = _asyncToGenerator(_regeneratorRuntime.mark(function _callee3(response) {\n    var message, contentType, text;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            message = \"Failed to fetch resource \".concat(response.url, \" (\").concat(response.status, \"): \");\n            _context3.prev = 1;\n            contentType = response.headers.get('Content-Type');\n            text = response.statusText;\n            if (!contentType.includes('application/json')) {\n              _context3.next = 11;\n              break;\n            }\n            _context3.t0 = text;\n            _context3.t1 = \" \";\n            _context3.next = 9;\n            return response.text();\n          case 9:\n            _context3.t2 = _context3.sent;\n            text = _context3.t0 += _context3.t1.concat.call(_context3.t1, _context3.t2);\n          case 11:\n            message += text;\n            message = message.length > 60 ? \"\".concat(message.slice(60), \"...\") : message;\n            _context3.next = 17;\n            break;\n          case 15:\n            _context3.prev = 15;\n            _context3.t3 = _context3[\"catch\"](1);\n          case 17:\n            return _context3.abrupt(\"return\", message);\n          case 18:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[1, 15]]);\n  }));\n  return _getResponseError.apply(this, arguments);\n}\nfunction getInitialDataUrl(_x4) {\n  return _getInitialDataUrl.apply(this, arguments);\n}\nfunction _getInitialDataUrl() {\n  _getInitialDataUrl = _asyncToGenerator(_regeneratorRuntime.mark(function _callee4(resource) {\n    var INITIAL_DATA_LENGTH, blobSlice, slice, base64;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            INITIAL_DATA_LENGTH = 5;\n            if (!(typeof resource === 'string')) {\n              _context4.next = 3;\n              break;\n            }\n            return _context4.abrupt(\"return\", \"data:,\".concat(resource.slice(0, INITIAL_DATA_LENGTH)));\n          case 3:\n            if (!(resource instanceof Blob)) {\n              _context4.next = 8;\n              break;\n            }\n            blobSlice = resource.slice(0, 5);\n            _context4.next = 7;\n            return new Promise(function (resolve) {\n              var reader = new FileReader();\n              reader.onload = function (event) {\n                return resolve(event.target && event.target.result);\n              };\n              reader.readAsDataURL(blobSlice);\n            });\n          case 7:\n            return _context4.abrupt(\"return\", _context4.sent);\n          case 8:\n            if (!(resource instanceof ArrayBuffer)) {\n              _context4.next = 12;\n              break;\n            }\n            slice = resource.slice(0, INITIAL_DATA_LENGTH);\n            base64 = arrayBufferToBase64(slice);\n            return _context4.abrupt(\"return\", \"data:base64,\".concat(base64));\n          case 12:\n            return _context4.abrupt(\"return\", null);\n          case 13:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _getInitialDataUrl.apply(this, arguments);\n}\nfunction arrayBufferToBase64(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  for (var i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}","map":{"version":3,"names":["isResponse","getResourceContentLength","getResourceUrlAndType","makeResponse","_x","_makeResponse","apply","arguments","_callee","resource","headers","contentLength","_getResourceUrlAndTyp","url","type","initialDataUrl","response","_regeneratorRuntime","wrap","_callee$","_context","prev","next","abrupt","String","getInitialDataUrl","sent","TextEncoder","encode","Response","Object","defineProperty","value","stop","checkResponse","_x2","_checkResponse","_callee2","message","_callee2$","_context2","ok","getResponseError","Error","checkResponseSync","concat","status","statusText","length","slice","_callee3","contentType","text","_callee3$","_context3","get","includes","t0","t1","t2","call","t3","_callee4","INITIAL_DATA_LENGTH","blobSlice","base64","_callee4$","_context4","Blob","Promise","resolve","reader","FileReader","onload","event","target","result","readAsDataURL","ArrayBuffer","arrayBufferToBase64","buffer","binary","bytes","Uint8Array","i","byteLength","fromCharCode","btoa"],"sources":["/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/kepler.gl/node_modules/@loaders.gl/core/src/lib/utils/response-utils.js"],"sourcesContent":["/* global Response, TextEncoder, Blob, FileReader, btoa */\nimport {isResponse} from '../../javascript-utils/is-type';\nimport {getResourceContentLength, getResourceUrlAndType} from './resource-utils';\n\nexport async function makeResponse(resource) {\n  if (isResponse(resource)) {\n    return resource;\n  }\n\n  // Add content-length header if possible\n  /** @type {Record<string, string>} */\n  const headers = {};\n\n  const contentLength = getResourceContentLength(resource);\n  if (contentLength >= 0) {\n    headers['content-length'] = String(contentLength);\n  }\n\n  // `new Response(File)` does not preserve content-type and URL\n  // so we add them here\n  const {url, type} = getResourceUrlAndType(resource);\n  if (type) {\n    headers['content-type'] = type;\n  }\n\n  // Add a custom header with initial bytes if available\n  const initialDataUrl = await getInitialDataUrl(resource);\n  if (initialDataUrl) {\n    headers['x-first-bytes'] = initialDataUrl;\n  }\n\n  // TODO - is this the best way of handling strings?\n  // Maybe package as data URL instead?\n  if (typeof resource === 'string') {\n    // Convert to ArrayBuffer to avoid Response treating it as a URL\n    resource = new TextEncoder().encode(resource);\n  }\n\n  // Attempt to create a Response from the resource, adding headers and setting url\n  const response = new Response(resource, {headers});\n  // We can't control `Response.url` via constructor, use a property override to record URL.\n  Object.defineProperty(response, 'url', {value: url});\n  return response;\n}\n\nexport async function checkResponse(response) {\n  if (!response.ok) {\n    const message = await getResponseError(response);\n    throw new Error(message);\n  }\n}\n\nexport function checkResponseSync(response) {\n  if (!response.ok) {\n    let message = `${response.status} ${response.statusText}`;\n    message = message.length > 60 ? `${message.slice(60)}...` : message;\n    throw new Error(message);\n  }\n}\n\n// HELPERS\n\nasync function getResponseError(response) {\n  let message = `Failed to fetch resource ${response.url} (${response.status}): `;\n  try {\n    const contentType = response.headers.get('Content-Type');\n    let text = response.statusText;\n    if (contentType.includes('application/json')) {\n      text += ` ${await response.text()}`;\n    }\n    message += text;\n    message = message.length > 60 ? `${message.slice(60)}...` : message;\n  } catch (error) {\n    // eslint forbids return in a finally statement, so we just catch here\n  }\n  return message;\n}\n\nasync function getInitialDataUrl(resource) {\n  const INITIAL_DATA_LENGTH = 5;\n  if (typeof resource === 'string') {\n    return `data:,${resource.slice(0, INITIAL_DATA_LENGTH)}`;\n  }\n  if (resource instanceof Blob) {\n    const blobSlice = resource.slice(0, 5);\n    return await new Promise(resolve => {\n      const reader = new FileReader();\n      reader.onload = event => resolve(event.target && event.target.result);\n      reader.readAsDataURL(blobSlice);\n    });\n  }\n  if (resource instanceof ArrayBuffer) {\n    const slice = resource.slice(0, INITIAL_DATA_LENGTH);\n    const base64 = arrayBufferToBase64(slice);\n    return `data:base64,${base64}`;\n  }\n  return null;\n}\n\n// https://stackoverflow.com/questions/9267899/arraybuffer-to-base64-encoded-string\nfunction arrayBufferToBase64(buffer) {\n  let binary = '';\n  const bytes = new Uint8Array(buffer);\n  for (let i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}