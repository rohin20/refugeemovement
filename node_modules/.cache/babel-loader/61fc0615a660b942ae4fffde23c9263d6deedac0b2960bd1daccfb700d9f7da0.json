{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _toConsumableArray from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _classCallCheck from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _get from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { default as JSONParser } from './json-parser';\nimport JSONPath from '../jsonpath/jsonpath';\nvar StreamingJSONParser = /*#__PURE__*/function (_JSONParser) {\n  _inherits(StreamingJSONParser, _JSONParser);\n  var _super = _createSuper(StreamingJSONParser);\n  function StreamingJSONParser() {\n    var _this;\n    _classCallCheck(this, StreamingJSONParser);\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _this = _super.call(this, {\n      onopenarray: function onopenarray() {\n        if (!_this.streamingArray) {\n          if (_this._matchJSONPath()) {\n            _this.streamingJsonPath = _this.getJsonPath().clone();\n            _this.streamingArray = [];\n            _this._openArray(_this.streamingArray);\n            return;\n          }\n        }\n        _this._openArray();\n      },\n      onopenobject: function onopenobject(name) {\n        if (!_this.topLevelObject) {\n          _this.topLevelObject = {};\n          _this._openObject(_this.topLevelObject);\n        } else {\n          _this._openObject({});\n        }\n        if (typeof name !== 'undefined') {\n          _this.parser.emit('onkey', name);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"jsonPaths\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"streamingJsonPath\", null);\n    _defineProperty(_assertThisInitialized(_this), \"streamingArray\", null);\n    _defineProperty(_assertThisInitialized(_this), \"topLevelObject\", null);\n    var jsonpaths = options.jsonpaths || [];\n    _this.jsonPaths = jsonpaths.map(function (jsonpath) {\n      return new JSONPath(jsonpath);\n    });\n    return _this;\n  }\n  _createClass(StreamingJSONParser, [{\n    key: \"write\",\n    value: function write(chunk) {\n      _get(_getPrototypeOf(StreamingJSONParser.prototype), \"write\", this).call(this, chunk);\n      var array = [];\n      if (this.streamingArray) {\n        array = _toConsumableArray(this.streamingArray);\n        this.streamingArray.length = 0;\n      }\n      return array;\n    }\n  }, {\n    key: \"getPartialResult\",\n    value: function getPartialResult() {\n      return this.topLevelObject;\n    }\n  }, {\n    key: \"getStreamingJsonPath\",\n    value: function getStreamingJsonPath() {\n      return this.streamingJsonPath;\n    }\n  }, {\n    key: \"getStreamingJsonPathAsString\",\n    value: function getStreamingJsonPathAsString() {\n      return this.streamingJsonPath && this.streamingJsonPath.toString();\n    }\n  }, {\n    key: \"getJsonPath\",\n    value: function getJsonPath() {\n      return this.jsonpath;\n    }\n  }, {\n    key: \"_matchJSONPath\",\n    value: function _matchJSONPath() {\n      var currentPath = this.getJsonPath();\n      if (this.jsonPaths.length === 0) {\n        return true;\n      }\n      var _iterator = _createForOfIteratorHelper(this.jsonPaths),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var jsonPath = _step.value;\n          if (jsonPath.equals(currentPath)) {\n            return true;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return false;\n    }\n  }]);\n  return StreamingJSONParser;\n}(JSONParser);\nexport { StreamingJSONParser as default };","map":{"version":3,"names":["default","JSONParser","JSONPath","StreamingJSONParser","_JSONParser","_inherits","_super","_createSuper","_this","_classCallCheck","options","arguments","length","undefined","call","onopenarray","streamingArray","_matchJSONPath","streamingJsonPath","getJsonPath","clone","_openArray","onopenobject","name","topLevelObject","_openObject","parser","emit","_defineProperty","_assertThisInitialized","jsonpaths","jsonPaths","map","jsonpath","_createClass","key","value","write","chunk","_get","_getPrototypeOf","prototype","array","_toConsumableArray","getPartialResult","getStreamingJsonPath","getStreamingJsonPathAsString","toString","currentPath","_iterator","_createForOfIteratorHelper","_step","s","n","done","jsonPath","equals","err","e","f"],"sources":["/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@kepler.gl/processors/node_modules/@loaders.gl/json/src/lib/parser/streaming-json-parser.ts"],"sourcesContent":["import {default as JSONParser} from './json-parser';\nimport JSONPath from '../jsonpath/jsonpath';\n\n/**\n * The `StreamingJSONParser` looks for the first array in the JSON structure.\n * and emits an array of chunks\n */\nexport default class StreamingJSONParser extends JSONParser {\n  private jsonPaths: JSONPath[];\n  private streamingJsonPath: JSONPath | null = null;\n  private streamingArray: any[] | null = null;\n  private topLevelObject: object | null = null;\n\n  constructor(options: {[key: string]: any} = {}) {\n    super({\n      onopenarray: () => {\n        if (!this.streamingArray) {\n          if (this._matchJSONPath()) {\n            // @ts-ignore\n            this.streamingJsonPath = this.getJsonPath().clone();\n            this.streamingArray = [];\n            this._openArray(this.streamingArray as []);\n            return;\n          }\n        }\n\n        this._openArray();\n      },\n\n      // Redefine onopenarray to inject value for top-level object\n      onopenobject: (name) => {\n        if (!this.topLevelObject) {\n          this.topLevelObject = {};\n          this._openObject(this.topLevelObject);\n        } else {\n          this._openObject({});\n        }\n        if (typeof name !== 'undefined') {\n          this.parser.emit('onkey', name);\n        }\n      }\n    });\n    const jsonpaths = options.jsonpaths || [];\n    this.jsonPaths = jsonpaths.map((jsonpath) => new JSONPath(jsonpath));\n  }\n\n  /**\n   * write REDEFINITION\n   * - super.write() chunk to parser\n   * - get the contents (so far) of \"topmost-level\" array as batch of rows\n   * - clear top-level array\n   * - return the batch of rows\\\n   */\n  write(chunk) {\n    super.write(chunk);\n    let array: any[] = [];\n    if (this.streamingArray) {\n      array = [...this.streamingArray];\n      this.streamingArray.length = 0;\n    }\n    return array;\n  }\n\n  /**\n   * Returns a partially formed result object\n   * Useful for returning the \"wrapper\" object when array is not top level\n   * e.g. GeoJSON\n   */\n  getPartialResult() {\n    return this.topLevelObject;\n  }\n\n  getStreamingJsonPath() {\n    return this.streamingJsonPath;\n  }\n\n  getStreamingJsonPathAsString() {\n    return this.streamingJsonPath && this.streamingJsonPath.toString();\n  }\n\n  getJsonPath() {\n    return this.jsonpath;\n  }\n\n  // PRIVATE METHODS\n\n  /**\n   * Checks is this.getJsonPath matches the jsonpaths provided in options\n   */\n  _matchJSONPath() {\n    const currentPath = this.getJsonPath();\n    // console.debug(`Testing JSONPath`, currentPath);\n\n    // Backwards compatibility, match any array\n    // TODO implement using wildcard once that is supported\n    if (this.jsonPaths.length === 0) {\n      return true;\n    }\n\n    for (const jsonPath of this.jsonPaths) {\n      if (jsonPath.equals(currentPath)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}