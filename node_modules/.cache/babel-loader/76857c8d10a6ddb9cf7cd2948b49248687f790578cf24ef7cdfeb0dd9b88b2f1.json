{"ast":null,"code":"import _toConsumableArray from \"/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport { Matrix4, Vector3 } from '@math.gl/core';\nimport { Ellipsoid } from '@math.gl/geospatial';\nvar cameraPositionCartesian = new Vector3();\nvar toEye = new Vector3();\nvar cameraPositionEnu = new Vector3();\nvar extraVertexEnu = new Vector3();\nvar projectedOriginVector = new Vector3();\nvar enuToCartesianMatrix = new Matrix4();\nvar cartesianToEnuMatrix = new Matrix4();\nexport function getLodStatus(tile, frameState) {\n  if (tile.lodMetricValue === 0 || isNaN(tile.lodMetricValue)) {\n    return 'DIG';\n  }\n  var screenSize = 2 * getProjectedRadius(tile, frameState);\n  if (screenSize < 2) {\n    return 'OUT';\n  }\n  if (!tile.header.children || screenSize <= tile.lodMetricValue) {\n    return 'DRAW';\n  } else if (tile.header.children) {\n    return 'DIG';\n  }\n  return 'OUT';\n}\nexport function getProjectedRadius(tile, frameState) {\n  var viewport = frameState.topDownViewport;\n  var mbsLat = tile.header.mbs[1];\n  var mbsLon = tile.header.mbs[0];\n  var mbsZ = tile.header.mbs[2];\n  var mbsR = tile.header.mbs[3];\n  var mbsCenterCartesian = _toConsumableArray(tile.boundingVolume.center);\n  var cameraPositionCartographic = viewport.unprojectPosition(viewport.cameraPosition);\n  Ellipsoid.WGS84.cartographicToCartesian(cameraPositionCartographic, cameraPositionCartesian);\n  toEye.copy(cameraPositionCartesian).subtract(mbsCenterCartesian).normalize();\n  Ellipsoid.WGS84.eastNorthUpToFixedFrame(mbsCenterCartesian, enuToCartesianMatrix);\n  cartesianToEnuMatrix.copy(enuToCartesianMatrix).invert();\n  cameraPositionEnu.copy(cameraPositionCartesian).transform(cartesianToEnuMatrix);\n  var projection = Math.sqrt(cameraPositionEnu[0] * cameraPositionEnu[0] + cameraPositionEnu[1] * cameraPositionEnu[1]);\n  var extraZ = projection * projection / cameraPositionEnu[2];\n  extraVertexEnu.copy([cameraPositionEnu[0], cameraPositionEnu[1], extraZ]);\n  var extraVertexCartesian = extraVertexEnu.transform(enuToCartesianMatrix);\n  var extraVectorCartesian = extraVertexCartesian.subtract(mbsCenterCartesian).normalize();\n  var radiusVector = toEye.cross(extraVectorCartesian).normalize().scale(mbsR);\n  var sphereMbsBorderVertexCartesian = radiusVector.add(mbsCenterCartesian);\n  var sphereMbsBorderVertexCartographic = Ellipsoid.WGS84.cartesianToCartographic(sphereMbsBorderVertexCartesian);\n  var projectedOrigin = viewport.project([mbsLon, mbsLat, mbsZ]);\n  var projectedMbsBorderVertex = viewport.project(sphereMbsBorderVertexCartographic);\n  var projectedRadius = projectedOriginVector.copy(projectedOrigin).subtract(projectedMbsBorderVertex).magnitude();\n  return projectedRadius;\n}","map":{"version":3,"names":["Matrix4","Vector3","Ellipsoid","cameraPositionCartesian","toEye","cameraPositionEnu","extraVertexEnu","projectedOriginVector","enuToCartesianMatrix","cartesianToEnuMatrix","getLodStatus","tile","frameState","lodMetricValue","isNaN","screenSize","getProjectedRadius","header","children","viewport","topDownViewport","mbsLat","mbs","mbsLon","mbsZ","mbsR","mbsCenterCartesian","_toConsumableArray","boundingVolume","center","cameraPositionCartographic","unprojectPosition","cameraPosition","WGS84","cartographicToCartesian","copy","subtract","normalize","eastNorthUpToFixedFrame","invert","transform","projection","Math","sqrt","extraZ","extraVertexCartesian","extraVectorCartesian","radiusVector","cross","scale","sphereMbsBorderVertexCartesian","add","sphereMbsBorderVertexCartographic","cartesianToCartographic","projectedOrigin","project","projectedMbsBorderVertex","projectedRadius","magnitude"],"sources":["/Users/rohinphukan/Desktop/RefugeeWebsite/node_modules/@deck.gl/geo-layers/node_modules/@loaders.gl/tiles/src/tileset/helpers/i3s-lod.ts"],"sourcesContent":["// loaders.gl, MIT license\n\nimport {Matrix4, Vector3} from '@math.gl/core';\nimport {Ellipsoid} from '@math.gl/geospatial';\nimport {Tile3D} from '../tile-3d';\nimport {FrameState} from './frame-state';\n\nconst cameraPositionCartesian = new Vector3();\nconst toEye = new Vector3();\nconst cameraPositionEnu = new Vector3();\nconst extraVertexEnu = new Vector3();\nconst projectedOriginVector = new Vector3();\nconst enuToCartesianMatrix = new Matrix4();\nconst cartesianToEnuMatrix = new Matrix4();\n\n/**\n * For the maxScreenThreshold error metric, maxError means that you should replace the node with it's children\n   as soon as the nodes bounding sphere has a screen radius larger than maxError pixels.\n   In this sense a value of 0 means you should always load it's children,\n   or if it's a leaf node, you should always display it.\n * @param tile \n * @param frameState \n * @returns \n */\nexport function getLodStatus(tile: Tile3D, frameState: FrameState): 'DIG' | 'OUT' | 'DRAW' {\n  if (tile.lodMetricValue === 0 || isNaN(tile.lodMetricValue)) {\n    return 'DIG';\n  }\n  const screenSize = 2 * getProjectedRadius(tile, frameState);\n  if (screenSize < 2) {\n    return 'OUT';\n  }\n  if (!tile.header.children || screenSize <= tile.lodMetricValue) {\n    return 'DRAW';\n  } else if (tile.header.children) {\n    return 'DIG';\n  }\n  return 'OUT';\n}\n\n/**\n * Calculate size of MBS radius projected on the screen plane\n * @param tile\n * @param frameState\n * @returns\n */\n// eslint-disable-next-line max-statements\nexport function getProjectedRadius(tile: Tile3D, frameState: FrameState): number {\n  const {topDownViewport: viewport} = frameState;\n  const mbsLat = tile.header.mbs[1];\n  const mbsLon = tile.header.mbs[0];\n  const mbsZ = tile.header.mbs[2];\n  const mbsR = tile.header.mbs[3];\n  const mbsCenterCartesian = [...tile.boundingVolume.center];\n  const cameraPositionCartographic = viewport.unprojectPosition(viewport.cameraPosition);\n  Ellipsoid.WGS84.cartographicToCartesian(cameraPositionCartographic, cameraPositionCartesian);\n\n  // ---------------------------\n  // Calculate mbs border vertex\n  // ---------------------------\n  toEye.copy(cameraPositionCartesian).subtract(mbsCenterCartesian).normalize();\n  // Add extra vector to form plane\n  Ellipsoid.WGS84.eastNorthUpToFixedFrame(mbsCenterCartesian, enuToCartesianMatrix);\n  cartesianToEnuMatrix.copy(enuToCartesianMatrix).invert();\n  cameraPositionEnu.copy(cameraPositionCartesian).transform(cartesianToEnuMatrix);\n  // Mean Proportionals in Right Triangles - Altitude rule\n  // https://mathbitsnotebook.com/Geometry/RightTriangles/RTmeanRight.html\n  const projection = Math.sqrt(\n    cameraPositionEnu[0] * cameraPositionEnu[0] + cameraPositionEnu[1] * cameraPositionEnu[1]\n  );\n  const extraZ = (projection * projection) / cameraPositionEnu[2];\n  extraVertexEnu.copy([cameraPositionEnu[0], cameraPositionEnu[1], extraZ]);\n  const extraVertexCartesian = extraVertexEnu.transform(enuToCartesianMatrix);\n  const extraVectorCartesian = extraVertexCartesian.subtract(mbsCenterCartesian).normalize();\n  // We need radius vector orthogonal to toEye vector\n  const radiusVector = toEye.cross(extraVectorCartesian).normalize().scale(mbsR);\n  const sphereMbsBorderVertexCartesian = radiusVector.add(mbsCenterCartesian);\n  const sphereMbsBorderVertexCartographic = Ellipsoid.WGS84.cartesianToCartographic(\n    sphereMbsBorderVertexCartesian\n  );\n  // ---------------------------\n\n  // Project center vertex and border vertex and calculate projected radius of MBS\n  const projectedOrigin = viewport.project([mbsLon, mbsLat, mbsZ]);\n  const projectedMbsBorderVertex = viewport.project(\n    sphereMbsBorderVertexCartographic as [number, number, number]\n  );\n  const projectedRadius = projectedOriginVector\n    .copy(projectedOrigin)\n    .subtract(projectedMbsBorderVertex)\n    .magnitude();\n  return projectedRadius;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}